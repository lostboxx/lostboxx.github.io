<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>—Ä–µ–¥–∞–∫—Ç–æ—Ä</title>

<link rel="stylesheet" href="tools_help/r1.css">
<script src="tools_help/r2.js"></script>
<script src="tools_help/r3.js"></script>
<script src="tools_help/r4.js"></script>
<script src="tools_help/r5.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;background:#000;color:#ccc;font-family:Consolas,monospace;}
#container{height:100%;display:flex;flex-direction:column;padding:10px;gap:10px}
#header{display:flex;justify-content:space-between;align-items:center;gap:10px}
button{background:none;border:none;color:#ccc;font-size:20px;cursor:pointer;transition:.3s;position:relative}
#editor-container{position:relative;flex:1}#highlighting,#editor{
  position:absolute;inset:0;width:100%;height:100%;margin:0;padding:10px;
  font-family:Consolas,monospace;font-size:18px;line-height:1.4em;
  white-space: pre;word-break: normal;border-radius:8px;overflow:auto;tab-size:2
}#highlighting{background:#000;color:#ccc;z-index:1;pointer-events:none}
#editor{background:transparent;color:transparent;caret-color:#fff;z-index:2;border:none;outline:none;resize:none}#highlighting code{
  display:block;
  font-size:18px;
  line-height:1.4em;
  white-space: pre;}#preview{flex:.8;width:100%;border:none;border-radius:8px;display:none;background:#fff}
#saveBox{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
background:#2c2c2c;padding:16px;border-radius:12px;display:none;flex-direction:column;align-items:center;gap:10px;z-index:999;width:300px}
#saveBox input,#saveBox select{width:100%;padding:6px;background:#1e1e1e;color:#ccc;border:1px solid #444;font-family:monospace;border-radius:5px}
#customExt{display:none}
.fullscreen #preview{display:block;position:fixed;top:50px;left:0;width:100%;height:calc(100% - 50px)}
.fullscreen #editor-container{display:none}

.tooltip {
  position: absolute;
  bottom: -25px;
  left: 50%;
  transform: translateX(-50%);
  background: #333;
  color: #fff;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
  z-index: 1000;
}

button:hover .tooltip {
  opacity: 1;
}

#console-container {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 40%;
  background: #1e1e1e;
  border-top: 1px solid #444;
  display: none;
  flex-direction: column;
  z-index: 1000;
}

#console-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: #2c2c2c;
  border-bottom: 1px solid #444;
  font-size: 14px;
  color: #ccc;
}

#console-close {
  background: none;
  border: none;
  color: #ccc;
  cursor: pointer;
  font-size: 16px;
}

#console-output {
  flex: 1;
  padding: 8px 12px;
  overflow-y: auto;
  font-family: Consolas, monospace;
  font-size: 14px;
  line-height: 1.4;
}

.console-log {
  color: #fff;
  margin-bottom: 4px;
}

.console-error {
  color: #ff5555;
  margin-bottom: 4px;
}

.console-warn {
  color: #ffcc00;
  margin-bottom: 4px;
}

.console-input-container {
  display: flex;
  padding: 8px 12px;
  border-top: 1px solid #444;
  background: #2c2c2c;
}

#console-prompt {
  color: #ccc;
  margin-right: 8px;
  line-height: 24px;
}

#console-input {
  flex: 1;
  background: transparent;
  border: none;
  color: #fff;
  font-family: Consolas, monospace;
  font-size: 14px;
  outline: none;
}

.console-command {
  color: #aaa;
  margin-bottom: 4px;
}

.console-result {
  margin-bottom: 8px;
  color: #fff;
}
</style>
</head>
<body>
<div id="container">
  <div id="header">
    <div>
      <button id="saveBtn">üíæ<span class="tooltip">–°–∫–∞—á–∞—Ç—å –∫–æ–¥</span></button>
      <button id="toggleBtn">‚ñ∂</button>
      <button id="consoleBtn">&gt;_</button>
      <button id="templateBtn">üßæ</button>
      <button id="clearBtn">üßπ</button>
    </div>
  </div>

  <div id="editor-container">
    <pre id="highlighting"><code class="language-html" id="highlight-content"></code></pre>
    <textarea id="editor" placeholder="–ø–∏—à–∏—Ç–µ —Ç—É—Ç —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ..."></textarea>
  </div>

  <iframe id="preview"></iframe>
</div>

<div id="console-container">
  <div id="console-header">
    <span>Console</span>
    <button id="console-close">‚úï</button>
  </div>
  <div id="console-output"></div>
  <div class="console-input-container">
    <span id="console-prompt">&gt;</span>
    <input type="text" id="console-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É...">
  </div>
</div>

<div id="saveBox">
  <input id="fileName" placeholder="–∏–º—è —Ñ–∞–π–ª–∞">
  <select id="extension">
    <option value=".html">.html</option>
    <option value=".txt">.txt</option>
    <option value=".js">.js</option>
    <option value=".css">.css</option>
    <option value="custom">custom</option>
  </select>
  <input id="customExt" placeholder=".xxx">
  <button id="downloadBtn">‚è¨</button>
</div>
<script>
const btn=document.getElementById('toggleBtn');
const editor=document.getElementById('editor');
const preview=document.getElementById('preview');
const saveBtn=document.getElementById('saveBtn');
const saveBox=document.getElementById('saveBox');
const fileNameInput=document.getElementById('fileName');
const extension=document.getElementById('extension');
const customExt=document.getElementById('customExt');
const downloadBtn=document.getElementById('downloadBtn');
const highlightContent=document.getElementById('highlight-content');
const templateBtn=document.getElementById('templateBtn');
const clearBtn=document.getElementById('clearBtn');
let previewMode=false;

const templateCode=`<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π —Å–∞–π—Ç</title>
    <style>
        * { 
            box-sizing: border-box; 
        }
        
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #f0f4f8;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        .toolbar {
            height: 60px;
            background: linear-gradient(to right, #1168c2, #0d5aa6, #1168c2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            flex-shrink: 0;
            z-index: 100;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 0;
        }

        .toolbar-right {
            display: flex;
            align-items: center;
        }

        .toolbar img {
            height: 40px;
            width: 40px;
            margin-right: 12px;
            image-rendering: pixelated;
            flex-shrink: 0;
        }

        .title {
            font-size: 1.4em;
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-shrink: 1;
        }

        .centered {
            flex: 1;
            display: flex;
            position: relative;
            padding: 20px;
        }

        .content-box {
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
            text-align: center;
        }

        .content-box h1 {
            color: #333;
            font-size: 2em;
            margin: 0;
            padding: 0 20px;
            opacity: 0.8;
        }

        .bottom-bar {
            height: 60px;
            background: linear-gradient(to right, #1168c2, #0d5aa6, #1168c2);
            flex-shrink: 0;
            z-index: 100;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        @media (max-width: 768px) {
            .centered { padding: 10px; }
            .content-box h1 { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <div class="toolbar-left">
            <img src="–ø—É—Ç—å_–∫_—Ç–≤–æ–µ–π_—Ñ–æ—Ç–∫–µ" alt="–Ω–∞–∑–≤–∞–Ω–∏–µ_—Ñ–æ—Ç–∫–∏">
            <div class="title">–ú–æ–π —Å–∞–π—Ç</div>
        </div>
        <div class="toolbar-right">
        </div>
    </div>

    <div class="centered">
        <div class="content-box fade-in">
            <h1>–¢—É—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–≤–æ–µ–≥–æ —Å–∞–π—Ç–∞!</h1>
            <p>–®–∞–±–ª–æ–Ω –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤</p>
            <ul>
            <li>‚úîÔ∏è –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö</li>
            <li>‚úîÔ∏è –õ–∏—á–Ω—ã—Ö —Ü–µ–ª—è—Ö</li>
            <li>‚úîÔ∏è –î–ª—è —Å–≤–æ–µ–≥–æ —Å–∞–π—Ç–∞</li>
            </ul>
    <p>–ó–∞–ø—Ä–µ—â–µ–Ω–æ</p>
    <ul>
    <li>‚ùå –í—ã–¥–∞–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ –∑–∞ —Å–≤–æ–π</li>
    <li>‚ùå –î–µ–ª–∞—Ç—å –æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å —ç—Ç–∏–º —à–∞–±–ª–æ–Ω–æ–º</li>
    </ul>
        </div>
    </div>

    <div class="bottom-bar"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('LostBox —à–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω!');
            console.warn('–≠—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–∑ HTML!');
            console.error('–≠—Ç–æ –æ—à–∏–±–∫–∞ –∏–∑ HTML!');
            
            setTimeout(() => {
                console.log('');
            }, 1000);
        });
    <script>
</body>
</html>`;

const consoleBtn = document.getElementById('consoleBtn');
const consoleContainer = document.getElementById('console-container');
const consoleClose = document.getElementById('console-close');
const consoleOutput = document.getElementById('console-output');
const consoleInput = document.getElementById('console-input');
let consoleVisible = false;

function addConsoleMessage(message, type = 'log') {
  const messageElement = document.createElement('div');
  messageElement.className = `console-${type}`;
  messageElement.textContent = message;
  consoleOutput.appendChild(messageElement);
  consoleOutput.scrollTop = consoleOutput.scrollHeight;
}

function interceptConsoleInIframe(iframe) {
  try {
    const iframeWindow = iframe.contentWindow;
    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
    
    const script = iframeDocument.createElement('script');
    script.textContent = `
      (function() {
        const originalConsole = {
          log: console.log,
          error: console.error,
          warn: console.warn,
          info: console.info,
          debug: console.debug
        };
        
        function sendToParentConsole(message, type) {
          try {
            window.parent.postMessage({
              type: 'console',
              message: message,
              consoleType: type
            }, '*');
          } catch(e) {
            originalConsole.log('Cannot send to parent:', e);
          }
        }
        
        console.log = function(...args) {
          originalConsole.log(...args);
          sendToParentConsole(args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
          ).join(' '), 'log');
        };
        
        console.error = function(...args) {
          originalConsole.error(...args);
          sendToParentConsole(args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
          ).join(' '), 'error');
        };
        
        console.warn = function(...args) {
          originalConsole.warn(...args);
          sendToParentConsole(args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
          ).join(' '), 'warn');
        };
        
        console.info = function(...args) {
          originalConsole.info(...args);
          sendToParentConsole(args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
          ).join(' '), 'log');
        };
        
        console.debug = function(...args) {
          originalConsole.debug(...args);
          sendToParentConsole(args.map(arg => 
            typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
          ).join(' '), 'log');
        };
        
        window.addEventListener('error', function(e) {
          sendToParentConsole(e.error?.stack || e.message, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
          sendToParentConsole(e.reason?.stack || e.reason, 'error');
        });
      })();
    `;
    
    iframeDocument.head.appendChild(script);
    
  } catch (e) {
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å console –≤ iframe:', e.message);
  }
}

window.addEventListener('message', function(event) {
  if (event.data && event.data.type === 'console') {
    addConsoleMessage(event.data.message, event.data.consoleType);
  }
});

consoleBtn.addEventListener('click', () => {
  consoleVisible = !consoleVisible;
  consoleContainer.style.display = consoleVisible ? 'flex' : 'none';
  if (consoleVisible) {
    consoleInput.focus();
  }
});

consoleClose.addEventListener('click', () => {
  consoleVisible = false;
  consoleContainer.style.display = 'none';
});

consoleInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const command = consoleInput.value.trim();
    if (command) {
      const commandElement = document.createElement('div');
      commandElement.className = 'console-command';
      commandElement.textContent = `> ${command}`;
      consoleOutput.appendChild(commandElement);
      
      try {
        let result;
        if (previewMode && preview.contentWindow) {
          result = preview.contentWindow.eval(command);
        } else {
          result = eval(command);
        }
        
        if (result !== undefined) {
          const resultElement = document.createElement('div');
          resultElement.className = 'console-result';
          resultElement.textContent = String(result);
          consoleOutput.appendChild(resultElement);
        }
      } catch (error) {
        const errorElement = document.createElement('div');
        errorElement.className = 'console-error';
        errorElement.textContent = error.toString();
        consoleOutput.appendChild(errorElement);
      }
      
      consoleInput.value = '';
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
  }
});

templateBtn.addEventListener('click', () => {
  editor.value = templateCode;
  updateHighlight();
});

clearBtn.addEventListener('click', () => {
  if (confirm("–¢–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–æ–¥?")) {
    editor.value = '';
    updateHighlight();
  }
});

function updateHighlight(){
  highlightContent.textContent=editor.value;
  Prism.highlightElement(highlightContent);
}

const SELF_CLOSING = new Set(['br','hr','img','input','meta','link','source','area','base','col','embed','param','track','wbr']);

editor.addEventListener('input', e=>{
  const val = editor.value;
  const pos = editor.selectionStart;
  if (pos === 0) { updateHighlight(); return; }

  const lastChar = val.charAt(pos - 1);
  const before = val.slice(0, pos);
  const after = val.slice(pos);

  if (lastChar === '>') {
    if (before.endsWith('<!--')) {
      const savedPos = pos;
      const savedAfter = after;
      setTimeout(()=>{
        const b = editor.value.slice(0, savedPos);
        const a = editor.value.slice(savedPos);
        editor.value = b + ' -->' + a;
        editor.selectionStart = editor.selectionEnd = b.length;
        updateHighlight();
      }, 0);
      return;
    }

    if (before.toLowerCase().endsWith('<!doctype>')) {
      const savedPos = pos;
      setTimeout(()=>{
        const b = editor.value.slice(0, savedPos - 1);
        const a = editor.value.slice(savedPos);
        const replacement = '<!doctype html>';
        const idx = b.lastIndexOf('<');
        const prefix = b.slice(0, idx);
        editor.value = prefix + replacement + a;
        editor.selectionStart = editor.selectionEnd = (prefix + replacement).length;
        updateHighlight();
      }, 0);
      return;
    }

const ltIndex = before.lastIndexOf('<');
    if (ltIndex !== -1) {
if (before.charAt(ltIndex + 1) !== '/') {
const tagContent = before.slice(ltIndex + 1, before.length - 1);
        const m = tagContent.match(/^\s*([a-zA-Z0-9:_-]+)/);
        if (m) {
          const tagName = m[1];
          if (!SELF_CLOSING.has(tagName.toLowerCase())) {
            const savedPos = pos;
            setTimeout(()=>{
const cur = editor.value;
const b = cur.slice(0, savedPos);
              const a = cur.slice(savedPos);
              const insert = `</${tagName}>`;
              editor.value = b + insert + a;
        editor.selectionStart = editor.selectionEnd = b.length;
              updateHighlight();
            }, 0);
            return;
          }
        }
      }
    }
  } 
  updateHighlight();
});

editor.addEventListener('keydown', e=>{
  const pairs = {'"':'"',"'" :"'",'`':'`','(' :')','[':']','{':'}'};
  const v = editor.value;
  const s = editor.selectionStart;
  const before = v.slice(0,s);
  const after = v.slice(s);

  if (pairs[e.key]) {
    e.preventDefault();
    editor.value = before + e.key + pairs[e.key] + after;
    editor.selectionStart = editor.selectionEnd = s + 1;
    updateHighlight();
    return;
  }

  const closers = Object.values(pairs);
  if (closers.includes(e.key) && after.startsWith(e.key)) {
    e.preventDefault();
    editor.selectionStart = editor.selectionEnd = s + 1;
    return;
  }
});
editor.addEventListener('scroll',()=>{
  const h=document.getElementById('highlighting');
  h.scrollTop=editor.scrollTop;
  h.scrollLeft=editor.scrollLeft;
});
btn.onclick=()=>{
  previewMode=!previewMode;
  saveBox.style.display='none';
  if(previewMode){
    document.body.classList.add('fullscreen');
    preview.style.display='block';
    preview.srcdoc=editor.value;
    btn.style.transform='rotate(90deg)';
    
preview.addEventListener('load', function() {
      interceptConsoleInIframe(preview);
      consoleOutput.innerHTML = '';
      addConsoleMessage('–ó–∞–≥—Ä—É–∂–µ–Ω–æ');
    });
  }else{
    document.body.classList.remove('fullscreen');
    preview.style.display='none';
    btn.style.transform='rotate(0deg)';
  }
};

saveBtn.onclick=()=>{
  if(!previewMode){
    saveBox.style.display='flex';
    fileNameInput.focus();
  }
};

extension.onchange=()=>{
  customExt.style.display=extension.value==='custom'?'block':'none';
};

downloadBtn.onclick=()=>{
  let name=fileNameInput.value.trim()||'–±–µ–∑_–∏–º–µ–Ω–∏';
  let ext=extension.value==='custom'?customExt.value.trim():extension.value;
  if(!ext.startsWith('.')) ext='.'+ext;
  const blob=new Blob([editor.value],{type:'text/plain'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=name+ext;
  a.click();
  a.remove();
  saveBox.style.display='none';
};

updateHighlight();
</script>
</body>
</html>