<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–∞—à–∫–∏</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            padding: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            font-size: 16px;
            margin-bottom: 15px;
            background-color: #fff;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .stat-item {
            margin: 5px 10px;
            min-width: 90px;
            text-align: center;
        }
        
        .message {
            font-size: 18px;
            margin: 10px 0;
            height: 30px;
            text-align: center;
            font-weight: bold;
        }
        
        .board-container {
            position: relative;
            max-width: 100%;
            overflow: auto;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            width: min(90vw, 400px);
            height: min(90vw, 400px);
            max-width: 400px;
            max-height: 400px;
        }
        
        .cell {
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        .light {
            background-color: #e0e0e0;
        }
        
        .dark {
            background-color: #40e0d0; /* –±–∏—Ä—é–∑–æ–≤—ã–π */
        }
        
        .piece {
            width: 80%;
            height: 80%;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: min(5vw, 24px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }
        
        .white {
            background-color: white;
            border: 1px solid #999;
        }
        
        .black {
            background-color: black;
            border: 1px solid #333;
        }
        
        .king .white {
            background-color: #f0f0f0;
        }
        
        .king .black {
            background-color: #333;
        }
        
        .selected {
            box-shadow: 0 0 0 3px yellow;
            z-index: 3;
        }
        
        .valid-move {
            position: relative;
        }
        
        .valid-move::after {
            content: "";
            position: absolute;
            width: 20%;
            height: 20%;
            background-color: rgba(0, 200, 0, 0.7);
            border-radius: 50%;
            z-index: 1;
        }
        
        .capture-move::after {
            background-color: rgba(255, 0, 0, 0.7);
            width: 30%;
            height: 30%;
        }
        
        .result-message {
            font-size: 22px;
            font-weight: bold;
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.95);
            text-align: center;
        }
        
        .controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .new-game-btn {
            padding: 10px 25px;
            font-size: 16px;
            background-color: #40e0d0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-weight: bold;
            margin-top: 10px;
        }
        
        @media (max-width: 480px) {
            .stats {
                font-size: 14px;
                padding: 8px 10px;
            }
            
            .stat-item {
                min-width: 70px;
                margin: 3px 5px;
            }
            
            .message {
                font-size: 16px;
            }
            
            .result-message {
                font-size: 20px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="stats">
        <span class="stat-item">–ü–æ–±–µ–¥: <span id="wins">0</span></span>
        <span class="stat-item">–ù–∏—á–µ–π: <span id="draws">0</span></span>
        <span class="stat-item">–ü–æ—Ä–∞–∂–µ–Ω–∏–π: <span id="losses">0</span></span>
    </div>
    
    <div class="message" id="message">–í–∞—à —Ö–æ–¥.</div>
    
    <div class="board-container">
        <div class="board" id="board"></div>
    </div>
    
    <div class="result-message" id="result" style="display: none;"></div>
    
    <div class="controls">
        <button class="new-game-btn" id="newGameBtn">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const BOARD_SIZE = 8;
        const PLAYER_COLOR = 'white';
        const BOT_COLOR = 'black';
        
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let board = [];
        let currentPlayer = PLAYER_COLOR;
        let selectedPiece = null;
        let validMoves = [];
        let stats = { wins: 0, draws: 0, losses: 0 };
        let gameOver = false;
        let mustContinueCapture = false; // –§–ª–∞–≥ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –≤–∑—è—Ç–∏—è
        let lastMoveWasCapture = false; // –§–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π, —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ö–æ–¥ –±—ã–ª –≤–∑—è—Ç–∏–µ–º
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const boardElement = document.getElementById('board');
        const messageElement = document.getElementById('message');
        const resultElement = document.getElementById('result');
        const winsElement = document.getElementById('wins');
        const drawsElement = document.getElementById('draws');
        const lossesElement = document.getElementById('losses');
        const newGameBtn = document.getElementById('newGameBtn');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IndexedDB
        function initDB() {
            const request = indexedDB.open('checkersDB', 1);
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                if (!db.objectStoreNames.contains('stats')) {
                    db.createObjectStore('stats');
                }
            };
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                loadStats(db);
            };
            
            request.onerror = function(event) {
                console.error('IndexedDB error:', event.target.error);
            };
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –ë–î
        function loadStats(db) {
            const transaction = db.transaction(['stats'], 'readonly');
            const store = transaction.objectStore('stats');
            const request = store.get('stats');
            
            request.onsuccess = function(event) {
                if (request.result) {
                    stats = request.result;
                    updateStatsDisplay();
                }
            };
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –ë–î
        function saveStats() {
            const request = indexedDB.open('checkersDB', 1);
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                const transaction = db.transaction(['stats'], 'readwrite');
                const store = transaction.objectStore('stats');
                store.put(stats, 'stats');
            };
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatsDisplay() {
            winsElement.textContent = stats.wins;
            drawsElement.textContent = stats.draws;
            lossesElement.textContent = stats.losses;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å–∫–∏
        function initBoard() {
            board = Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(null));
            
            // –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ —à–∞—à–µ–∫
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if ((row + col) % 2 === 1) {
                        board[row][col] = { color: BOT_COLOR, king: false };
                    }
                }
            }
            
            for (let row = 5; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    if ((row + col) % 2 === 1) {
                        board[row][col] = { color: PLAYER_COLOR, king: false };
                    }
                }
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å–∫–∏
        function renderBoard() {
            boardElement.innerHTML = '';
            
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = `cell ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–∞–ª–∏–¥–Ω—ã–π —Ö–æ–¥
                    const moveInfo = validMoves.find(move => 
                        move.row === row && move.col === col);
                    
                    if (moveInfo) {
                        cell.classList.add('valid-move');
                        if (moveInfo.isCapture) {
                            cell.classList.add('capture-move');
                        }
                    }
                    
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —à–∞—à–∫–∏
                    const piece = board[row][col];
                    if (piece) {
                        const pieceElement = document.createElement('div');
                        pieceElement.className = `piece ${piece.color} ${piece.king ? 'king' : ''}`;
                        
                        // –í—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —à–∞—à–∫–∏
                        if (selectedPiece && 
                            selectedPiece.row === row && 
                            selectedPiece.col === col) {
                            pieceElement.classList.add('selected');
                        }
                        
                        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä–æ–Ω—ã –¥–ª—è –∫–æ—Ä–æ–ª—è
                        if (piece.king) {
                            pieceElement.textContent = 'üëë';
                        }
                        
                        cell.appendChild(pieceElement);
                    }
                    
                    cell.addEventListener('click', handleCellClick);
                    boardElement.appendChild(cell);
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleCellClick(event) {
            if (gameOver || currentPlayer !== PLAYER_COLOR) return;
            
            const row = parseInt(event.currentTarget.dataset.row);
            const col = parseInt(event.currentTarget.dataset.col);
            const piece = board[row][col];
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ, –æ–Ω –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç—É –∂–µ —à–∞—à–∫—É
            if (mustContinueCapture && selectedPiece && 
                !(selectedPiece.row === row && selectedPiece.col === col)) {
                // –ò–≥—Ä–æ–∫ –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é —à–∞—à–∫—É, –∫–æ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ
                return;
            }
            
            // –í—ã–±–æ—Ä —à–∞—à–∫–∏ –∏–≥—Ä–æ–∫–∞
            if (piece && piece.color === PLAYER_COLOR) {
                // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ, –æ–Ω –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç—É –∂–µ —à–∞—à–∫—É
                if (mustContinueCapture && selectedPiece && 
                    !(selectedPiece.row === row && selectedPiece.col === col)) {
                    return;
                }
                
                selectedPiece = { row, col };
                validMoves = getValidMoves(row, col);
                renderBoard();
                return;
            }
            
            // –•–æ–¥ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–ª–µ—Ç–∫—É
            if (selectedPiece) {
                const moveInfo = validMoves.find(move => 
                    move.row === row && move.col === col);
                
                if (moveInfo) {
                    const wasCapture = movePiece(selectedPiece.row, selectedPiece.col, row, col, moveInfo.isCapture, moveInfo.captures);
                    
                    // –ï—Å–ª–∏ –±—ã–ª —Å–¥–µ–ª–∞–Ω –∑–∞—Ö–≤–∞—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ
                    if (wasCapture) {
                        const furtherCaptures = getCaptureMoves(row, col);
                        if (furtherCaptures.length > 0) {
                            // –ò–≥—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ
                            mustContinueCapture = true;
                            selectedPiece = { row, col };
                            validMoves = furtherCaptures;
                            renderBoard();
                            messageElement.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –±—Ä–∞—Ç—å —à–∞—à–∫–∏.';
                            return;
                        }
                    }
                    
                    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥ —Ö–æ–¥–∞
                    mustContinueCapture = false;
                    selectedPiece = null;
                    validMoves = [];
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                    if (!checkGameOver()) {
                        currentPlayer = BOT_COLOR;
                        messageElement.textContent = '–•–æ–¥ –±–æ—Ç–∞...';
                        setTimeout(botMove, 800);
                    }
                }
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ö–æ–¥–æ–≤ –¥–ª—è —à–∞—à–∫–∏
        function getValidMoves(row, col) {
            const piece = board[row][col];
            if (!piece) return [];
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –≤–∑—è—Ç–∏–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∑—è—Ç–∏—è
            const captureMoves = getCaptureMoves(row, col);
            if (captureMoves.length > 0) {
                return captureMoves;
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤–∑—è—Ç–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–µ —Ö–æ–¥—ã
            return getRegularMoves(row, col);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–æ–¥–æ–≤ —Å–æ –≤–∑—è—Ç–∏–µ–º
        function getCaptureMoves(row, col) {
            const piece = board[row][col];
            if (!piece) return [];
            
            const moves = [];
            const directions = [[-1, -1], [-1, 1], [1, -1], [1, 1]]; // –í—Å–µ 4 –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            
            for (const [dr, dc] of directions) {
                findCaptureMovesInDirection(row, col, dr, dc, piece, moves, []);
            }
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ö–æ–¥—ã, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–∑—è—Ç–∏–π
            if (moves.length > 0) {
                let maxCaptures = 0;
                for (const move of moves) {
                    if (move.captures.length > maxCaptures) {
                        maxCaptures = move.captures.length;
                    }
                }
                
                return moves.filter(move => move.captures.length === maxCaptures);
            }
            
            return moves;
        }
        
        // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ —Ö–æ–¥–æ–≤ —Å–æ –≤–∑—è—Ç–∏–µ–º –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
        function findCaptureMovesInDirection(row, col, dr, dc, piece, moves, capturedSoFar) {
            if (!piece.king) {
                // –î–ª—è –æ–±—ã—á–Ω–æ–π —à–∞—à–∫–∏
                const jumpRow = row + dr * 2;
                const jumpCol = col + dc * 2;
                const enemyRow = row + dr;
                const enemyCol = col + dc;
                
                if (isValidPosition(jumpRow, jumpCol) && 
                    !board[jumpRow][jumpCol] &&
                    board[enemyRow][enemyCol] && 
                    board[enemyRow][enemyCol].color !== piece.color &&
                    !isAlreadyCaptured(enemyRow, enemyCol, capturedSoFar)) {
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ö–æ–¥ —Å–æ –≤–∑—è—Ç–∏–µ–º
                    moves.push({
                        row: jumpRow,
                        col: jumpCol,
                        isCapture: true,
                        captures: [...capturedSoFar, {row: enemyRow, col: enemyCol}]
                    });
                    
                    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤–∑—è—Ç–∏—è
                    const simulatedBoard = JSON.parse(JSON.stringify(board));
                    simulatedBoard[jumpRow][jumpCol] = simulatedBoard[row][col];
                    simulatedBoard[row][col] = null;
                    simulatedBoard[enemyRow][enemyCol] = null;
                    
                    findFurtherCaptures(jumpRow, jumpCol, piece, moves, [...capturedSoFar, {row: enemyRow, col: enemyCol}], simulatedBoard);
                }
            } else {
                // –î–ª—è –∫–æ—Ä–æ–ª—è - –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –≤ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
                let foundEnemy = false;
                let enemyPos = null;
                
                for (let distance = 1; distance < BOARD_SIZE; distance++) {
                    const checkRow = row + dr * distance;
                    const checkCol = col + dc * distance;
                    
                    if (!isValidPosition(checkRow, checkCol)) break;
                    
                    if (!foundEnemy) {
                        if (board[checkRow][checkCol]) {
                            if (board[checkRow][checkCol].color !== piece.color &&
                                !isAlreadyCaptured(checkRow, checkCol, capturedSoFar)) {
                                foundEnemy = true;
                                enemyPos = {row: checkRow, col: checkCol};
                            } else {
                                // –°–≤–æ—è —à–∞—à–∫–∞ –∏–ª–∏ —É–∂–µ –≤–∑—è—Ç–∞—è - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                                break;
                            }
                        }
                    } else {
                        // –ü–æ—Å–ª–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤—Ä–∞–∂–µ—Å–∫–æ–π —à–∞—à–∫–∏ –∏—â–µ–º –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É –¥–ª—è –ø—Ä—ã–∂–∫–∞
                        if (!board[checkRow][checkCol]) {
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ö–æ–¥ —Å–æ –≤–∑—è—Ç–∏–µ–º
                            moves.push({
                                row: checkRow,
                                col: checkCol,
                                isCapture: true,
                                captures: [...capturedSoFar, enemyPos]
                            });
                            
                            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤–∑—è—Ç–∏—è
                            const simulatedBoard = JSON.parse(JSON.stringify(board));
                            simulatedBoard[checkRow][checkCol] = simulatedBoard[row][col];
                            simulatedBoard[row][col] = null;
                            simulatedBoard[enemyPos.row][enemyPos.col] = null;
                            
                            findFurtherCaptures(checkRow, checkCol, piece, moves, [...capturedSoFar, enemyPos], simulatedBoard);
                        } else {
                            // –ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞ - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                            break;
                        }
                    }
                }
            }
        }
        
        // –ü–æ–∏—Å–∫ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –≤–∑—è—Ç–∏–π –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ
        function findFurtherCaptures(row, col, piece, moves, capturedSoFar, simulatedBoard) {
            const directions = [[-1, -1], [-1, 1], [1, -1], [1, 1]];
            
            for (const [dr, dc] of directions) {
                if (!piece.king) {
                    // –î–ª—è –æ–±—ã—á–Ω–æ–π —à–∞—à–∫–∏
                    const jumpRow = row + dr * 2;
                    const jumpCol = col + dc * 2;
                    const enemyRow = row + dr;
                    const enemyCol = col + dc;
                    
                    if (isValidPosition(jumpRow, jumpCol) && 
                        !simulatedBoard[jumpRow][jumpCol] &&
                        simulatedBoard[enemyRow][enemyCol] && 
                        simulatedBoard[enemyRow][enemyCol].color !== piece.color &&
                        !isAlreadyCaptured(enemyRow, enemyCol, capturedSoFar)) {
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º —Ö–æ–¥ —Å–æ –≤–∑—è—Ç–∏–µ–º
                        moves.push({
                            row: jumpRow,
                            col: jumpCol,
                            isCapture: true,
                            captures: [...capturedSoFar, {row: enemyRow, col: enemyCol}]
                        });
                        
                        // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤–∑—è—Ç–∏—è
                        const newSimulatedBoard = JSON.parse(JSON.stringify(simulatedBoard));
                        newSimulatedBoard[jumpRow][jumpCol] = newSimulatedBoard[row][col];
                        newSimulatedBoard[row][col] = null;
                        newSimulatedBoard[enemyRow][enemyCol] = null;
                        
                        findFurtherCaptures(jumpRow, jumpCol, piece, moves, [...capturedSoFar, {row: enemyRow, col: enemyCol}], newSimulatedBoard);
                    }
                } else {
                    // –î–ª—è –∫–æ—Ä–æ–ª—è
                    let foundEnemy = false;
                    let enemyPos = null;
                    
                    for (let distance = 1; distance < BOARD_SIZE; distance++) {
                        const checkRow = row + dr * distance;
                        const checkCol = col + dc * distance;
                        
                        if (!isValidPosition(checkRow, checkCol)) break;
                        
                        if (!foundEnemy) {
                            if (simulatedBoard[checkRow][checkCol]) {
                                if (simulatedBoard[checkRow][checkCol].color !== piece.color &&
                                    !isAlreadyCaptured(checkRow, checkCol, capturedSoFar)) {
                                    foundEnemy = true;
                                    enemyPos = {row: checkRow, col: checkCol};
                                } else {
                                    // –°–≤–æ—è —à–∞—à–∫–∞ –∏–ª–∏ —É–∂–µ –≤–∑—è—Ç–∞—è - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                                    break;
                                }
                            }
                        } else {
                            // –ü–æ—Å–ª–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –≤—Ä–∞–∂–µ—Å–∫–æ–π —à–∞—à–∫–∏ –∏—â–µ–º –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É –¥–ª—è –ø—Ä—ã–∂–∫–∞
                            if (!simulatedBoard[checkRow][checkCol]) {
                                // –î–æ–±–∞–≤–ª—è–µ–º —Ö–æ–¥ —Å–æ –≤–∑—è—Ç–∏–µ–º
                                moves.push({
                                    row: checkRow,
                                    col: checkCol,
                                    isCapture: true,
                                    captures: [...capturedSoFar, enemyPos]
                                });
                                
                                // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ–º –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤–∑—è—Ç–∏—è
                                const newSimulatedBoard = JSON.parse(JSON.stringify(simulatedBoard));
                                newSimulatedBoard[checkRow][checkCol] = newSimulatedBoard[row][col];
                                newSimulatedBoard[row][col] = null;
                                newSimulatedBoard[enemyPos.row][enemyPos.col] = null;
                                
                                findFurtherCaptures(checkRow, checkCol, piece, moves, [...capturedSoFar, enemyPos], newSimulatedBoard);
                            } else {
                                // –ö–ª–µ—Ç–∫–∞ –∑–∞–Ω—è—Ç–∞ - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫
                                break;
                            }
                        }
                    }
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–µ –±—ã–ª–∞ –ª–∏ —É–∂–µ –≤–∑—è—Ç–∞ —ç—Ç–∞ —à–∞—à–∫–∞ –≤ —Ç–µ–∫—É—â–µ–π —Ü–µ–ø–æ—á–∫–µ
        function isAlreadyCaptured(row, col, capturedSoFar) {
            return capturedSoFar.some(capture => capture.row === row && capture.col === col);
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö —Ö–æ–¥–æ–≤ (–±–µ–∑ –≤–∑—è—Ç–∏—è)
        function getRegularMoves(row, col) {
            const piece = board[row][col];
            if (!piece) return [];
            
            const moves = [];
            const directions = [];
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–≤–∏–∂–µ–Ω–∏—è
            if (piece.king) {
                // –ö–æ—Ä–æ–ª—å —Ö–æ–¥–∏—Ç –≤–æ –≤—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                directions.push([-1, -1], [-1, 1], [1, -1], [1, 1]);
            } else {
                // –û–±—ã—á–Ω–∞—è —à–∞—à–∫–∞ —Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥
                if (piece.color === PLAYER_COLOR) {
                    directions.push([-1, -1], [-1, 1]); // –í–≤–µ—Ä—Ö
                } else {
                    directions.push([1, -1], [1, 1]); // –í–Ω–∏–∑
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
            for (const [dr, dc] of directions) {
                if (piece.king) {
                    // –ö–æ—Ä–æ–ª—å –º–æ–∂–µ—Ç —Ö–æ–¥–∏—Ç—å –Ω–∞ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–µ—Ç–æ–∫
                    for (let distance = 1; distance < BOARD_SIZE; distance++) {
                        const newRow = row + dr * distance;
                        const newCol = col + dc * distance;
                        
                        if (!isValidPosition(newRow, newCol)) break;
                        
                        if (!board[newRow][newCol]) {
                            moves.push({ row: newRow, col: newCol, isCapture: false });
                        } else {
                            // –ù–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ —à–∞—à–∫—É - –¥–∞–ª—å—à–µ –Ω–µ–ª—å–∑—è
                            break;
                        }
                    }
                } else {
                    // –û–±—ã—á–Ω–∞—è —à–∞—à–∫–∞ —Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω—É –∫–ª–µ—Ç–∫—É
                    const newRow = row + dr;
                    const newCol = col + dc;
                    
                    if (isValidPosition(newRow, newCol) && !board[newRow][newCol]) {
                        moves.push({ row: newRow, col: newCol, isCapture: false });
                    }
                }
            }
            
            return moves;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
        function isValidPosition(row, col) {
            return row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE;
        }
        
        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —à–∞—à–∫–∏
        function movePiece(fromRow, fromCol, toRow, toCol, isCapture, captures = []) {
            const piece = board[fromRow][fromCol];
            board[fromRow][fromCol] = null;
            board[toRow][toCol] = piece;
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –≤–∑—è—Ç–æ–π —à–∞—à–∫–∏
            if (isCapture) {
                if (captures.length > 0) {
                    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ —à–∞—à–∫–∏
                    for (const capture of captures) {
                        board[capture.row][capture.col] = null;
                    }
                } else {
                    // –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                    const capturedRow = (fromRow + toRow) / 2;
                    const capturedCol = (fromCol + toCol) / 2;
                    board[capturedRow][capturedCol] = null;
                }
                
                lastMoveWasCapture = true;
            } else {
                lastMoveWasCapture = false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è –≤ –∫–æ—Ä–æ–ª—è
            if (!piece.king) {
                if ((piece.color === PLAYER_COLOR && toRow === 0) || 
                    (piece.color === BOT_COLOR && toRow === BOARD_SIZE - 1)) {
                    piece.king = true;
                }
            }
            
            renderBoard();
            return isCapture;
        }
        
        // –•–æ–¥ –±–æ—Ç–∞
        function botMove() {
            if (gameOver) return;
            
            // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Ö–æ–¥—ã —Å–æ –≤–∑—è—Ç–∏–µ–º
            let captureMoves = [];
            let regularMoves = [];
            
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const piece = board[row][col];
                    if (piece && piece.color === BOT_COLOR) {
                        const moves = getValidMoves(row, col);
                        moves.forEach(move => {
                            const moveData = {
                                fromRow: row,
                                fromCol: col,
                                toRow: move.row,
                                toCol: move.col,
                                isCapture: move.isCapture,
                                captures: move.captures || [],
                                score: move.captures ? move.captures.length * 10 : 0
                            };
                            
                            if (move.isCapture) {
                                captureMoves.push(moveData);
                            } else {
                                regularMoves.push(moveData);
                            }
                        });
                    }
                }
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–∑—è—Ç–∏—è, —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
            if (captureMoves.length > 0) {
                let maxCaptures = 0;
                for (const move of captureMoves) {
                    if (move.captures.length > maxCaptures) {
                        maxCaptures = move.captures.length;
                    }
                }
                captureMoves = captureMoves.filter(move => move.captures.length === maxCaptures);
            }
            
            // –í—ã–±–æ—Ä —Ö–æ–¥–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–∑—è—Ç–∏—è–º)
            let selectedMove = null;
            if (captureMoves.length > 0) {
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≤–∑—è—Ç–∏–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º captured —à–∞—à–µ–∫
                selectedMove = captureMoves[Math.floor(Math.random() * captureMoves.length)];
            } else if (regularMoves.length > 0) {
                selectedMove = regularMoves[Math.floor(Math.random() * regularMoves.length)];
            }
            
            if (selectedMove) {
                movePiece(
                    selectedMove.fromRow, 
                    selectedMove.fromCol, 
                    selectedMove.toRow, 
                    selectedMove.toCol,
                    selectedMove.isCapture,
                    selectedMove.captures
                );
                
                // –ï—Å–ª–∏ –±—ã–ª –∑–∞—Ö–≤–∞—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±—Ä–∞—Ç—å
                if (selectedMove.isCapture) {
                    const furtherCaptures = getCaptureMoves(selectedMove.toRow, selectedMove.toCol);
                    if (furtherCaptures.length > 0) {
                        // –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ
                        setTimeout(() => {
                            botContinueCapture(selectedMove.toRow, selectedMove.toCol);
                        }, 800);
                        return;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                if (!checkGameOver()) {
                    currentPlayer = PLAYER_COLOR;
                    messageElement.textContent = '–í–∞—à —Ö–æ–¥.';
                }
            } else {
                // –ï—Å–ª–∏ —É –±–æ—Ç–∞ –Ω–µ—Ç —Ö–æ–¥–æ–≤
                endGame('draw');
            }
        }
        
        // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤–∑—è—Ç–∏—è –¥–ª—è –±–æ—Ç–∞
        function botContinueCapture(row, col) {
            const captureMoves = getCaptureMoves(row, col);
            
            if (captureMoves.length > 0) {
                // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –≤–∑—è—Ç–∏–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º captured —à–∞—à–µ–∫
                let maxCaptures = 0;
                for (const move of captureMoves) {
                    if (move.captures.length > maxCaptures) {
                        maxCaptures = move.captures.length;
                    }
                }
                const maxCaptureMoves = captureMoves.filter(move => move.captures.length === maxCaptures);
                const selectedMove = maxCaptureMoves[Math.floor(Math.random() * maxCaptureMoves.length)];
                
                movePiece(
                    row, 
                    col, 
                    selectedMove.row, 
                    selectedMove.col,
                    true,
                    selectedMove.captures
                );
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç –ª–∏ –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –±—Ä–∞—Ç—å
                const furtherCaptures = getCaptureMoves(selectedMove.row, selectedMove.col);
                if (furtherCaptures.length > 0) {
                    // –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤–∑—è—Ç–∏–µ
                    setTimeout(() => {
                        botContinueCapture(selectedMove.row, selectedMove.col);
                    }, 800);
                } else {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                    if (!checkGameOver()) {
                        currentPlayer = PLAYER_COLOR;
                        messageElement.textContent = '–í–∞—à —Ö–æ–¥.';
                    }
                }
            } else {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
                if (!checkGameOver()) {
                    currentPlayer = PLAYER_COLOR;
                    messageElement.textContent = '–í–∞—à —Ö–æ–¥.';
                }
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        function checkGameOver() {
            let playerPieces = 0;
            let botPieces = 0;
            let playerCanMove = false;
            let botCanMove = false;
            
            // –ü–æ–¥—Å—á—ë—Ç —à–∞—à–µ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ö–æ–¥–∞
            for (let row = 0; row < BOARD_SIZE; row++) {
                for (let col = 0; col < BOARD_SIZE; col++) {
                    const piece = board[row][col];
                    if (piece) {
                        if (piece.color === PLAYER_COLOR) {
                            playerPieces++;
                            if (!playerCanMove && getValidMoves(row, col).length > 0) {
                                playerCanMove = true;
                            }
                        } else {
                            botPieces++;
                            if (!botCanMove && getValidMoves(row, col).length > 0) {
                                botCanMove = true;
                            }
                        }
                    }
                }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–≥—Ä—ã
            if (playerPieces === 0 || !playerCanMove) {
                endGame('loss');
                return true;
            }
            
            if (botPieces === 0 || !botCanMove) {
                endGame('win');
                return true;
            }
            
            return false;
        }
        
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame(result) {
            gameOver = true;
            
            switch (result) {
                case 'win':
                    resultElement.textContent = 'üòé –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!';
                    stats.wins++;
                    break;
                case 'loss':
                    resultElement.textContent = 'üòî –ü—Ä–æ–∏–≥—Ä—ã—à';
                    stats.losses++;
                    break;
                case 'draw':
                    resultElement.textContent = 'üòê –ù–∏—á—å—è';
                    stats.draws++;
                    break;
            }
            
            resultElement.style.display = 'block';
            messageElement.textContent = '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            updateStatsDisplay();
            saveStats();
        }
        
        // –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        function newGame() {
            initBoard();
            currentPlayer = PLAYER_COLOR;
            selectedPiece = null;
            validMoves = [];
            gameOver = false;
            mustContinueCapture = false;
            lastMoveWasCapture = false;
            messageElement.textContent = '–í–∞—à —Ö–æ–¥.';
            resultElement.style.display = 'none';
            renderBoard();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            initDB();
            initBoard();
            newGameBtn.addEventListener('click', newGame);
            renderBoard();
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>