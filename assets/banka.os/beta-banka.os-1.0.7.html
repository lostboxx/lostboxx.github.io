<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
<meta name="robots" content="noindex, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BANKA.OS beta 1.0.6</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      font-family: sans-serif;
      background: black;
      overflow: hidden;
    }
    .screen {
      display: none;
      width: 100%; height: 100%;
      position: absolute; top: 0; left: 0;
      background: black; color: white;
      justify-content: center; align-items: center; flex-direction: column;
    }
    #photoSquare {
      width: 80vmin; height: 80vmin;
      background: white; margin-bottom: 20px;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
    }
    #photoSquare img {
      width: 100%; height: 100%; object-fit: cover;
    }
    button {
      background: white; color: black;
      border: none; border-radius: 12px;
      padding: 10px 20px; margin: 10px;
      font-size: 1.2em; cursor: pointer;
    }
    #audioBtn {
      position: fixed; bottom: 20px; right: 20px;
      background: white; border-radius: 50%;
      width: 50px; height: 50px;
      font-size: 1.5em; display: none;
      align-items: center; justify-content: center;
      z-index: 1000;
    }
    #backBtn {
      position: absolute; top: 10px; left: 10px;
      background: white; border-radius: 50%;
      width: 40px; height: 40px; font-size: 1.2em; z-index: 100;
    }
    #favoriteBtn {
  position: absolute; top: 10px; right: 10px;
  background: white; border-radius: 50%;
  width: 40px; height: 40px; font-size: 1.2em; z-index: 100;
}
#starBtn {
  background: white; border-radius: 50%;
  width: 40px; height: 40px; font-size: 1.2em;
  margin-bottom: 10px; cursor: pointer;
  border: none;
}
#avatar, #avatarProfile {
  width: 100px; height: 100px;
  object-fit: cover; border-radius: 10px;
  margin-bottom: 20px;
}
canvas {
  position: absolute; top: 0; left: 0;
}
#win {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(255,255,255,0.9); color: #000;
  padding: 20px; border-radius: 10px;
  display: none; z-index: 10; text-align: center;
}
#gameNotice {
  position: absolute; top: 10%; left: 50%;
  transform: translateX(-50%);
  background: yellow; color: black;
  padding: 10px 20px; border-radius: 10px;
  display: none; z-index: 30;
}
#pinPromptOverlay {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%; background: rgba(0,0,0,0.8);
  display: none; justify-content: center; align-items: center; z-index: 10000;
}
#pinPromptBox {
  background: white; color: black;
  padding: 20px; border-radius: 10px;
  display: flex; flex-direction: column; align-items: center;
}
#pinPromptBox input {
  font-size: 1.2em; padding: 5px; margin: 10px;
  width: 100px; text-align: center;
}
#pinWarning {
  margin-top: 10px; color: orange; font-size: 0.9em; display: none;
}
.achievement {
  background: gold; padding: 10px 20px;
  border-radius: 12px; color: black;
  font-size: 1.1em; text-align: center; position: fixed;
  top: 10%; left: 50%; transform: translateX(-50%);
  display: none; z-index: 1000;
}
#favoritesGallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  padding: 20px;
  max-height: 70vh;
  overflow-y: auto;
  width: 90%;
}
.favorite-item {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 10px;
  cursor: pointer;
}
#notesSection {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
  height: calc(100% - 100px);
}
#notesList {
  width: 100%;
  flex-grow: 1;
  overflow-y: auto;
  padding: 10px;
}
.note {
  background: #333;
  padding: 15px;
  margin: 10px 0;
  border-radius: 10px;
  position: relative;
  cursor: pointer;
}
    .note-content {
      white-space: pre-wrap;
      word-break: break-word;
    }
    .note-preview {
      color: #aaa;
    }
    .note-delete {
      position: absolute;
      top: 5px;
      right: 5px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      cursor: pointer;
    }
    #addNoteBtn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #noteEditor {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    #noteEditor textarea {
      width: 80%;
      height: 60%;
      padding: 15px;
      font-size: 1.2em;
      background: #333;
      color: white;
      border: none;
      border-radius: 10px;
    }
    #noteEditor button {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <video id="bootVideo" muted playsinline style="position:absolute;width:100%;height:100%;object-fit:cover;z-index:9999;">
    <source src="https://files.catbox.moe/2fzdfk.mp4" type="video/mp4" />
  </video>
  <button id="startBtn" style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);z-index:10000;padding:20px 40px;background:white;color:black;font-size:1.5em;border:none;border-radius:12px;cursor:pointer;">–ù–∞—á–∞—Ç—å</button>
  <div id="pinPromptOverlay">
  <div id="pinPromptBox">
    <div id="pinPromptText" style="font-size:1.2em;color:black;">–í–≤–µ–¥–∏—Ç–µ PIN-–∫–æ–¥:</div>
    <input type="password" id="pinInput" maxlength="4" />
    <button onclick="submitPin()">OK</button>
    <div id="pinWarning">‚ö† –û—Å—Ç–∞–ª–æ—Å—å 5 –ø–æ–ø—ã—Ç–æ–∫, –∏–Ω–∞—á–µ BANKA.OS –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω–∞</div>
  </div>
</div>

<div id="loginScreen" class="screen">
  <img id="avatar" src="https://files.catbox.moe/94rsda.jpg" alt="Avatar" />
  <button onclick="attemptLogin()">‚ñ∂ –í–æ–π—Ç–∏</button>
  <div style="font-size: 1.5em;" id="userDisplay">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: BANKA</div>
</div>

<div id="mainMenu" class="screen">
  <button onclick="playClick(); showSection('photo')">üì∏ –§–æ—Ç–æ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º</button>
  <button onclick="playClick(); showSection('game')">üéÆ –ü–æ–∏–≥—Ä–∞—Ç—å –≤ ParodiaBall</button>
  <button onclick="playClick(); showSection('notes')">üìù –ó–∞–º–µ—Ç–∫–∏</button>
  <button onclick="playClick(); showSection('achievements')">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
  <button onclick="playClick(); showSection('settings')">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>

<div id="photoSection" class="screen">
  <button id="backBtn" onclick="showSection('main')">‚óÄ</button>
  <button id="favoriteBtn" onclick="showSection('favorites')">üåü</button>
  <button id="starBtn" onclick="toggleFavorite()">‚òÜ</button>
  <div id="photoSquare"></div>
  <button onclick="playClick(); showPhoto()">–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ç–æ</button>
</div>

<div id="favoritesSection" class="screen">
  <button id="backBtn" onclick="showSection('photo')">‚óÄ</button>
  <div id="favoritesGallery"></div>
</div>
<div id="notesSection" class="screen">
  <button id="backBtn" onclick="showSection('main')">‚óÄ</button>
  <div id="notesList"></div>
  <button id="addNoteBtn" onclick="createNewNote()">+</button>
</div>

<div id="achievementsSection" class="screen">
  <button id="backBtn" onclick="showSection('main')">‚óÄ</button>
  <div id="achievementList"></div>
</div>

<div id="settingsSection" class="screen">
  <button id="backBtn" onclick="showSection('main')">‚óÄ</button>
  <button onclick="showSection('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button onclick="showSection('pinSettings')">–ü–∞—Ä–æ–ª—å</button>
</div>

<div id="profileSection" class="screen">
  <button id="backBtn" onclick="showSection('settings')">‚óÄ</button>
  <img id="avatarProfile" src="https://files.catbox.moe/94rsda.jpg" alt="Avatar" />
  <div style="font-size:1.2em;" id="userDisplayProfile">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: BANKA</div>
  <button onclick="changeNameProfile()">–°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
  <button onclick="changeAvatarProfile()">–°–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ</button>
  <button onclick="resetProfile()">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
</div>

<div id="pinSettingsSection" class="screen">
  <button id="backBtn" onclick="showSection('settings')">‚óÄ</button>
  <button onclick="setPin()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PIN-–∫–æ–¥</button>
  <button onclick="removePin()">–£–¥–∞–ª–∏—Ç—å PIN-–∫–æ–¥</button>
</div>
<div id="gameSection" class="screen">
  <button id="backBtn" onclick="showSection('main')">‚óÄ</button>
  <div id="gameNotice">–ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è ParodiaBall —Å–ª–æ–º–∞–Ω–Ω–∞—è, –ø—Ä–æ—Å–∏–º –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ü–ö –≤–µ—Ä—Å–∏—é —Å–∞–π—Ç–∞!</div>
  <canvas id="gameCanvas"></canvas>
  <div id="win">
    <div>–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏!</div>
    <button onclick="nextLevel()">–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>
  </div>
</div>

<div id="achievementBanner" class="achievement"></div>

<div id="noteEditor">
  <textarea id="noteEditorText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏..."></textarea>
  <button onclick="saveNote()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <button onclick="cancelEdit()">–û—Ç–º–µ–Ω–∞</button>
</div>

<input type="file" id="avatarInput" accept="image/*" style="display:none;" />
<button id="audioBtn" onclick="toggleAudio()">üîá</button>

<audio id="clickSound"><source src="https://files.catbox.moe/xp0o5c.mp3" /></audio>
<audio id="winSound"><source src="https://files.catbox.moe/1f2se4.mp3" /></audio>
<audio id="startupSound"><source src="https://files.catbox.moe/otlana.mp3" /></audio>
<audio id="bgMusic" loop><source src="https://files.catbox.moe/w7d9lj.mp3" /></audio>

<script>
  const bootVideo = document.getElementById("bootVideo");
  const startBtn = document.getElementById("startBtn");
  const pinOverlay = document.getElementById("pinPromptOverlay");
  const pinInput = document.getElementById("pinInput");
  const pinWarning = document.getElementById("pinWarning");
  const loginScreen = document.getElementById("loginScreen");
  const mainMenu = document.getElementById("mainMenu");
  const photoSection = document.getElementById("photoSection");
  const favoritesSection = document.getElementById("favoritesSection");
  const notesSection = document.getElementById("notesSection");
  const notesList = document.getElementById("notesList");
  const addNoteBtn = document.getElementById("addNoteBtn");
  const noteEditor = document.getElementById("noteEditor");
  const noteEditorText = document.getElementById("noteEditorText");
  const achievementsSection = document.getElementById("achievementsSection");
const settingsSection = document.getElementById("settingsSection");
const profileSection = document.getElementById("profileSection");
const pinSettingsSection = document.getElementById("pinSettingsSection");
const gameSection = document.getElementById("gameSection");
const avatar = document.getElementById("avatar");
const avatarProfile = document.getElementById("avatarProfile");
const userDisplay = document.getElementById("userDisplay");
const userDisplayProfile = document.getElementById("userDisplayProfile");
const avatarInput = document.getElementById("avatarInput");
const clickSound = document.getElementById("clickSound");
const winSound = document.getElementById("winSound");
const startupSound = document.getElementById("startupSound");
const bgMusic = document.getElementById("bgMusic");
const audioBtn = document.getElementById("audioBtn");
const gameNotice = document.getElementById("gameNotice");
const achievementBanner = document.getElementById("achievementBanner");
const achievementList = document.getElementById("achievementList");
const starBtn = document.getElementById("starBtn");
const favoritesGallery = document.getElementById("favoritesGallery");

let musicIsPlaying = false;
let level = 1;
let pinTries = 0;
let achievements = JSON.parse(localStorage.getItem("achievements")) || [];
let currentPhotoUrl = '';
let favoritePhotos = JSON.parse(localStorage.getItem("favoritePhotos")) || [];
let notes = JSON.parse(localStorage.getItem("notes")) || [];
let currentNoteIndex = -1;
let lastClickTime = 0;

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const winScreen = document.getElementById("win");

const GRAVITY = 0.5;
const JUMP_VY = -12;
const MOVE_SPEED = 3;
const PLATFORM_WIDTH = 120;
const PLATFORM_HEIGHT = 12;
const STAR_RADIUS = 10;
const TOTAL_PLATFORMS = 20;
const STAR_PLATFORMS = [10, 15, 20];

let platforms = [], stars = [], starsCollected = 0;
let ball = { x: 0, y: 0, radius: 15, vx: 0, vy: 0 };
let moving = { left: false, right: false };
let animFrameId = null;

window.addEventListener("load", () => {
  const playPromise = bootVideo.play();
  if (playPromise !== undefined) {
    playPromise.then(() => {
      bootVideo.addEventListener("ended", () => {
        bootVideo.style.display = "none";
        showScreen(loginScreen);
        initSettings();
      });
    }).catch(() => {
      startBtn.style.display = "block";
    });
  } else {
    startBtn.style.display = "block";
  }
  setTimeout(() => {
    if (!bootVideo.ended) {
      startBtn.style.display = "block";
    }
  }, 8000);
});
startBtn.onclick = () => {
  bootVideo.style.display = "none";
  startBtn.style.display = "none";
  showScreen(loginScreen);
  initSettings();
};

function hideAll() {
  [loginScreen, mainMenu, photoSection, favoritesSection, notesSection, 
   achievementsSection, settingsSection, profileSection, 
   pinSettingsSection, gameSection].forEach(s => s.style.display = 'none');
}

function showScreen(screenEl) {
  hideAll();
  screenEl.style.display = 'flex';
  if (screenEl === notesSection) {
    updateNotesList();
  }
}

function initSettings() {
  const name = localStorage.getItem("banka_name");
  const ava = localStorage.getItem("banka_avatar");
  if (name) {
    userDisplay.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + name;
    userDisplayProfile.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: " + name;
  }
  if (ava) {
    avatar.src = ava;
    avatarProfile.src = ava;
  }
  updateAchievements();
}

function attemptLogin() {
  const pin = localStorage.getItem("banka_pin");
  if (pin) {
    pinOverlay.style.display = 'flex';
    pinInput.value = '';
    pinWarning.style.display = 'none';
    pinTries = 0;
  } else {
    startOS();
  }
}

function submitPin() {
  const saved = localStorage.getItem("banka_pin");
  if (pinInput.value === saved) {
    pinOverlay.style.display = 'none';
    pinTries = 0;
    startOS();
  } else {
    pinTries++;
    if (pinTries >= 5 && pinTries < 10) {
      pinWarning.style.display = 'block';
    }
    if (pinTries >= 10) {
      resetProfile();
      localStorage.removeItem("banka_pin");
      pinTries = 0;
      pinOverlay.style.display = 'none';
      alert("–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã. –ó–∞–ø—É—Å–∫ –∑–∞–Ω–æ–≤–æ.");
      showScreen(loginScreen);
    } else {
      alert("–ù–µ–≤–µ—Ä–Ω—ã–π PIN. –ü–æ–ø—ã—Ç–æ–∫: " + pinTries + "/10");
    }
  }
}

function startOS() {
  showScreen(mainMenu);
  audioBtn.style.display = 'flex';
  startupSound.play().catch(() => {});
}

function playClick() {
  if (!musicIsPlaying) { clickSound.currentTime = 0; clickSound.play(); }
}

function playWinSound() {
  if (!musicIsPlaying) { winSound.currentTime = 0; winSound.play(); }
}

function toggleAudio() {
  if (bgMusic.paused) {
    bgMusic.play().catch(() => {});
    audioBtn.textContent = "üîä";
    musicIsPlaying = true;
  } else {
    bgMusic.pause();
    audioBtn.textContent = "üîá";
    musicIsPlaying = false;
  }
}

function showSection(name) {
  switch(name) {
    case 'main': showScreen(mainMenu); break;
    case 'photo': showScreen(photoSection); showPhoto(); break;
    case 'favorites': showScreen(favoritesSection); showFavorites(); break;
    case 'notes': showScreen(notesSection); break;
    case 'achievements': showScreen(achievementsSection); updateAchievements(); break;
    case 'settings': showScreen(settingsSection); break;
    case 'profile': showScreen(profileSection); break;
    case 'pinSettings': showScreen(pinSettingsSection); break;
    case 'game':
      showScreen(gameSection);
      gameNotice.style.display = 'block';
      setTimeout(() => gameNotice.style.display = 'none', 5000);
      initGame();
      break;
  }
}
function showPhoto() {
  const photoSquare = document.getElementById("photoSquare");
  const randomUrl = `https://picsum.photos/800?random=${Math.floor(Math.random() * 10000)}`;
  currentPhotoUrl = randomUrl;
  photoSquare.innerHTML = `<img src="${randomUrl}" alt="Random">`;
  starBtn.textContent = favoritePhotos.includes(randomUrl) ? "‚òÖ" : "‚òÜ";
}

function toggleFavorite() {
  if (favoritePhotos.includes(currentPhotoUrl)) {
    favoritePhotos = favoritePhotos.filter(url => url !== currentPhotoUrl);
    starBtn.textContent = "‚òÜ";
  } else {
    favoritePhotos.push(currentPhotoUrl);
    starBtn.textContent = "‚òÖ";
  }
  localStorage.setItem("favoritePhotos", JSON.stringify(favoritePhotos));
}

function showFavorites() {
  favoritesGallery.innerHTML = '';
  if (favoritePhotos.length === 0) {
    favoritesGallery.innerHTML = '<div style="color:white;text-align:center;">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ</div>';
    return;
  }
  
  favoritePhotos.forEach(url => {
    const img = document.createElement('img');
    img.src = url;
    img.className = 'favorite-item';
    img.onclick = () => {
      currentPhotoUrl = url;
      showSection('photo');
    };
    favoritesGallery.appendChild(img);
  });
}

function initGame() {
  if (animFrameId) cancelAnimationFrame(animFrameId);
  
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  platforms = [];
  stars = [];
  starsCollected = 0;
  winScreen.style.display = 'none';
  
  const vSpacing = canvas.height / (TOTAL_PLATFORMS + 1);
  let prevX = canvas.width / 2 - PLATFORM_WIDTH / 2;
  
  for (let i = 1; i <= TOTAL_PLATFORMS; i++) {
    const y = canvas.height - vSpacing * i;
    const step = (Math.random() * 2 - 1) * 80;
    let x = prevX + step;
    x = Math.max(10, Math.min(x, canvas.width - PLATFORM_WIDTH - 10));
    platforms.push({ x, y, w: PLATFORM_WIDTH, h: PLATFORM_HEIGHT });
    if (STAR_PLATFORMS.includes(i)) {
      stars.push({ x: x + PLATFORM_WIDTH/2, y: y - STAR_RADIUS - 5, r: STAR_RADIUS, collected: false });
    }
    prevX = x;
  }
  
  resetBall();
  animFrameId = requestAnimationFrame(gameLoop);
}

function resetBall() {
  const p = platforms[0];
  ball.x = p.x + p.w / 2;
  ball.y = p.y - ball.radius;
  ball.vx = 0;
  ball.vy = 0;
}

function gameLoop() {
  updateGame();
  drawGame();
  animFrameId = requestAnimationFrame(gameLoop);
}

function updateGame() {
  ball.vy += GRAVITY;
  if (moving.left) ball.vx = -MOVE_SPEED;
  else if (moving.right) ball.vx = MOVE_SPEED;
  else ball.vx *= 0.8;
  
  ball.x += ball.vx;
  ball.y += ball.vy;
  
  platforms.forEach(p => {
    if (ball.vy > 0 && ball.y + ball.radius >= p.y && ball.y + ball.radius <= p.y + p.h && 
        ball.x + ball.radius > p.x && ball.x - ball.radius < p.x + p.w) {
      ball.y = p.y - ball.radius;
      ball.vy = JUMP_VY;
    }
  });
  
  stars.forEach(s => {
    if (!s.collected) {
      const dx = ball.x - s.x;
      const dy = ball.y - s.y;
      if (Math.hypot(dx,dy) < ball.radius + s.r/2) {
        s.collected = true;
        starsCollected++;
        if (starsCollected === stars.length) {
          winScreen.style.display = 'block';
          playWinSound();
        }
      }
    }
  });
  
  if (ball.y - ball.radius > canvas.height) resetBall();
  if (ball.x < ball.radius) ball.x = ball.radius;
  if (ball.x > canvas.width - ball.radius) ball.x = canvas.width - ball.radius;
}

function drawGame() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'skyblue';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = 'white';
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));
  
  stars.forEach(s => {
    if (!s.collected) {
      ctx.beginPath();
      for (let i = 0; i < 5; i++) {
        const ang = i * 2 * Math.PI / 5 - Math.PI/2;
        const rad = i % 2 === 0 ? s.r : s.r/2;
        ctx.lineTo(s.x + Math.cos(ang)*rad, s.y + Math.sin(ang)*rad);
      }
      ctx.closePath();
      ctx.fillStyle = 'gold'; 
      ctx.fill();
    }
  });
  
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
  ctx.fillStyle = 'yellow';
  ctx.fill();
  
  ctx.fillStyle = '#000';
  ctx.font = '20px sans-serif';
  ctx.fillText('–£—Ä–æ–≤–µ–Ω—å: '+level, 10, 30);
}

function nextLevel() {
  level++;
  winScreen.style.display = 'none';
  initGame();
}

window.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') moving.left = true;
  if (e.key === 'ArrowRight') moving.right = true;
});

window.addEventListener('keyup', e => {
  if (e.key === 'ArrowLeft') moving.left = false;
  if (e.key === 'ArrowRight') moving.right = false;
});

window.addEventListener('mousedown', e => {
  moving.left = e.clientX < canvas.width/2;
  moving.right = !moving.left;
});

window.addEventListener('mouseup', () => { 
  moving.left = moving.right = false; 
});

window.addEventListener('touchstart', e => {
  const x = e.touches[0].clientX;
  moving.left = x < canvas.width/2;
  moving.right = !moving.left;
});

window.addEventListener('touchend', () => { 
  moving.left = moving.right = false; 
});

function updateNotesList() {
  notesList.innerHTML = '';
  if (notes.length === 0) {
    notesList.innerHTML = '<div style="color:#aaa;text-align:center;">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</div>';
    return;
  }
  
  notes.forEach((note, index) => {
    const noteEl = document.createElement('div');
    noteEl.className = 'note';
    
    const preview = note.length > 20 ? note.substring(0, 20) + '...' : note;
    const fullContent = note;
    
    noteEl.innerHTML = `
      <div class="note-preview">${preview}</div>
      <div class="note-content" style="display:none;">${fullContent}</div>
      <button class="note-delete" onclick="deleteNote(${index},event)">√ó</button>
    `;
    
    noteEl.onclick = (e) => {
      if (e.target.classList.contains('note-delete')) return;
      
      const now = new Date().getTime();
      if (now - lastClickTime < 300) {
        editNote(index);
      } else {
        const preview = noteEl.querySelector('.note-preview');
        const content = noteEl.querySelector('.note-content');
        
        if (preview.style.display === 'none') {
          preview.style.display = 'block';
          content.style.display = 'none';
        } else {
          preview.style.display = 'none';
          content.style.display = 'block';
        }
      }
      lastClickTime = now;
    };
    
    notesList.appendChild(noteEl);
  });
}

function createNewNote() {
  currentNoteIndex = -1;
  noteEditorText.value = '';
  noteEditor.style.display = 'flex';
  noteEditorText.focus();
}

function editNote(index) {
  currentNoteIndex = index;
  noteEditorText.value = notes[index];
  noteEditor.style.display = 'flex';
  noteEditorText.focus();
}

function saveNote() {
  const text = noteEditorText.value.trim();
  if (text) {
    if (currentNoteIndex === -1) {
      notes.push(text);
    } else {
      notes[currentNoteIndex] = text;
    }
    localStorage.setItem("notes", JSON.stringify(notes));
    updateNotesList();
  }
  noteEditor.style.display = 'none';
}

function cancelEdit() {
  noteEditor.style.display = 'none';
}

function deleteNote(index, event) {
  event.stopPropagation();
  if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–º–µ—Ç–∫—É?')) {
    notes.splice(index, 1);
    localStorage.setItem("notes", JSON.stringify(notes));
    updateNotesList();
  }
}
</script>
</body>
</html>