<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BANKA.OS beta 1.0.8</title>
  <style>
    /* Обновленные стили загрузчика */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #000;
      overflow: hidden;
      font-family: sans-serif;
    }
    
    .loader-container {
      position: fixed;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    
    .logo-wrapper {
      display: flex;
      align-items: center;
      margin-bottom: 40px;
    }
    
    .loader-text {
      opacity: 0;
      text-shadow: 0 0 8px rgba(255,255,255,0.7);
    }
    
    .loader-text.banka {
      display: inline-block;
      font-size: 3rem;
      color: #fff;
      animation: fadeIn 1.5s forwards;
      text-shadow: 0 0 8px rgba(255,255,255,0.8), 0 0 16px rgba(255,255,255,0.5);
    }
    
    .loader-text.os {
      display: inline-block;
      font-size: 2.5rem;
      color: #ff0;
      animation: fadeIn 1.5s forwards;
      animation-delay: 1.5s;
      text-shadow: 0 0 8px rgba(255,255,0,0.8), 0 0 16px rgba(255,255,0,0.5);
      margin-left: 0.5rem;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .dots {
      display: flex;
      justify-content: center;
      opacity: 0;
      animation: showDotsContainer 0.1s forwards;
      animation-delay: 3s;
    }
    
    @keyframes showDotsContainer {
      to { opacity: 1; }
    }
    
    .dot {
      width: 12px;
      height: 12px;
      background: #fff;
      margin: 0 5px;
      opacity: 0;
      animation: blinkDot 1.5s infinite;
    }
    
    .dot:nth-child(1) { animation-delay: 3s; }
    .dot:nth-child(2) { animation-delay: 3.5s; }
    .dot:nth-child(3) { animation-delay: 4s; }
    
    @keyframes blinkDot {
      0%   { opacity: 0; }
      10%  { opacity: 1; }
      30%  { opacity: 1; }
      40%  { opacity: 0; }
      100% { opacity: 0; }
    }
    
    .particles {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 0; 
      height: 0;
      pointer-events: none;
    }
    
    .particle {
      position: absolute;
      width: 6px; 
      height: 6px;
      background: #00aaff;
      border-radius: 50%;
      animation: fly 2s infinite ease-out;
    }
    
    @keyframes fly {
      0% { 
        transform: translate(0, 0) scale(1); 
        opacity: 1; 
      }
      100% { 
        transform: translate(var(--dx), var(--dy)) scale(0.5); 
        opacity: 0; 
      }
    }

    /* Основные стили ОС */
    .screen {
      display: none;
      width: 100%; 
      height: 100%;
      position: absolute; 
      top: 0; 
      left: 0;
      background: black; 
      color: white;
      justify-content: center; 
      align-items: center; 
      flex-direction: column;
      transition: transform 0.5s ease;
    }
    
    #loginScreen {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    #mainMenu {
      background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .unlock-container {
      width: 100%;
      text-align: center;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-bottom: 50px;
    }
    
    .unlock-text {
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 15px;
      transition: all 0.3s ease;
    }
    
    .unlock-arrow {
      font-size: 2.5rem;
      color: rgba(255, 255, 255, 0.7);
      animation: pulseArrow 2s infinite;
    }
    
    @keyframes pulseArrow {
      0% { transform: translateY(0); opacity: 0.7; }
      50% { transform: translateY(-10px); opacity: 1; }
      100% { transform: translateY(0); opacity: 0.7; }
    }
    
    #photoSquare {
      width: 80vmin; 
      height: 80vmin;
      background: white; 
      margin-bottom: 20px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      overflow: hidden;
    }
    
    #photoSquare img {
      width: 100%; 
      height: 100%; 
      object-fit: cover;
    }
    
    button {
      background: white; 
      color: black;
      border: none; 
      border-radius: 12px;
      padding: 10px 20px; 
      margin: 10px;
      font-size: 1.2em; 
      cursor: pointer;
    }
    
    #audioBtn {
      position: fixed; 
      bottom: 20px; 
      right: 20px;
      background: white; 
      border-radius: 50%;
      width: 50px; 
      height: 50px;
      font-size: 1.5em; 
      display: none;
      align-items: center; 
      justify-content: center;
      z-index: 1000;
    }
    
    .backBtn {
      position: absolute; 
      top: 10px; 
      left: 10px;
      background: white; 
      border-radius: 50%;
      width: 40px; 
      height: 40px; 
      font-size: 1.2em; 
      z-index: 100;
    }
    
    #favoriteBtn {
      position: absolute; 
      top: 10px; 
      right: 10px;
      background: white; 
      border-radius: 50%;
      width: 40px; 
      height: 40px; 
      font-size: 1.2em; 
      z-index: 100;
    }
    
    #starBtn {
      background: white; 
      border-radius: 50%;
      width: 40px; 
      height: 40px; 
      font-size: 1.2em;
      margin-bottom: 10px; 
      cursor: pointer;
      border: none;
    }
    
    #avatar, #avatarProfile {
      width: 100px; 
      height: 100px;
      object-fit: cover; 
      border-radius: 10px;
      margin-bottom: 20px;
    }
    
    canvas {
      position: absolute; 
      top: 0; 
      left: 0;
    }
    
    #win {
      position: absolute; 
      top: 50%; 
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255,255,255,0.9); 
      color: #000;
      padding: 20px; 
      border-radius: 10px;
      display: none; 
      z-index: 10; 
      text-align: center;
    }
    
    #gameNotice {
      position: absolute; 
      top: 10%; 
      left: 50%;
      transform: translateX(-50%);
      background: yellow; 
      color: black;
      padding: 10px 20px; 
      border-radius: 10px;
      display: none; 
      z-index: 30;
    }
    
    #pinPromptOverlay {
      position: absolute; 
      top: 0; 
      left: 0;
      width: 100%; 
      height: 100%; 
      background: rgba(0,0,0,0.8);
      display: none; 
      justify-content: center; 
      align-items: center; 
      z-index: 10000;
    }
    
    #pinPromptBox {
      background: white; 
      color: black;
      padding: 20px; 
      border-radius: 10px;
      display: flex; 
      flex-direction: column; 
      align-items: center;
    }
    
    #pinPromptBox input {
      font-size: 1.2em; 
      padding: 5px; 
      margin: 10px;
      width: 100px; 
      text-align: center;
    }
    
    #pinWarning {
      margin-top: 10px; 
      color: orange; 
      font-size: 0.9em; 
      display: none;
    }
    
    .achievement {
      background: gold; 
      padding: 10px 20px;
      border-radius: 12px; 
      color: black;
      font-size: 1.1em; 
      text-align: center; 
      position: fixed;
      top: 10%; 
      left: 50%; 
      transform: translateX(-50%);
      display: none; 
      z-index: 1000;
    }
    
    #favoritesGallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      padding: 20px;
      max-height: 70vh;
      overflow-y: auto;
      width: 90%;
    }
    
    .favorite-item {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
    }
    
    #notesSection {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      height: calc(100% - 100px);
    }
    
    #notesList {
      width: 100%;
      flex-grow: 1;
      overflow-y: auto;
      padding: 10px;
    }
    
    .note {
      background: #333;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      position: relative;
      cursor: pointer;
    }
    
    .note-content {
      white-space: pre-wrap;
      word-break: break-word;
    }
    
    .note-preview {
      color: #aaa;
    }
    
    .note-delete {
      position: absolute;
      top: 5px;
      right: 5px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      cursor: pointer;
    }
    
    #addNoteBtn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    #noteEditor {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    
    #noteEditor textarea {
      width: 80%;
      height: 60%;
      padding: 15px;
      font-size: 1.2em;
      background: #333;
      color: white;
      border: none;
      border-radius: 10px;
    }
    
    #noteEditor button {
      margin-top: 10px;
    }
    
    /* Стили для Раздавилки */
    #razdavilkaSection {
      padding-top: 50px; /* Чтобы не перекрывалось кнопкой назад */
    }
    
    .razdavilka-container {
      width: 100%;
      max-width: 360px;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    
    .preview-wrapper {
      width: 100%;
      overflow: auto;
      max-height: 70vh;
      display: flex;
      justify-content: center;
    }
    
    .preview-container {
      position: relative;
      width: 100%;
      max-width: 300px;
      border: 2px dashed #555;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: #222;
      overflow: hidden;
    }
    
    .preview-canvas {
      display: none;
      background: #000;
      width: 100%;
      height: auto;
    }
    
    .placeholder-text {
      text-align: center;
      color: #777;
      padding: 10px;
      position: absolute;
      font-size: 14px;
      pointer-events: none;
    }
    
    .buttons-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
    }
    
    .razdavilka-btn {
      padding: 6px 10px;
      background: #0cf;
      border: none;
      border-radius: 6px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }
    
    .active-btn {
      background: #0fa;
    }
    
    .note-insert {
      margin-top: 6px;
      font-size: 12px;
      color: #ccc;
      text-align: center;
    }
    
    .download-btn {
      margin-top: 8px;
      padding: 8px 12px;
      background: #0cf;
      border: none;
      border-radius: 6px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }
    
    .hidden-input {
      display: none;
    }
    
    /* Стили для раздела обучения */
    #tutorialSection {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      overflow: hidden;
      display: none;
    }
    
    .tutorial-container {
      width: 90%;
      max-width: 800px;
      height: 80vh;
      overflow-y: auto;
      padding: 20px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 200, 255, 0.3);
      animation: scrollReveal 0.5s ease-out forwards;
    }
    
    @keyframes scrollReveal {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .tutorial-section {
      margin: 30px 0;
      padding: 20px;
      border-radius: 12px;
      animation: fadeInSection 0.8s ease-out;
      position: relative;
      overflow: hidden;
    }
    
    .tutorial-section::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
    }
    
    @keyframes fadeInSection {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .tutorial-section h2 {
      font-size: 1.8rem;
      margin-bottom: 15px;
      text-shadow: 0 0 10px currentColor;
    }
    
    .tutorial-section p {
      font-size: 1.1rem;
      line-height: 1.6;
      margin: 10px 0;
    }
    
    .tutorial-section ul {
      padding-left: 20px;
      margin: 15px 0;
    }
    
    .tutorial-section li {
      margin: 8px 0;
      position: relative;
      padding-left: 25px;
    }
    
    .tutorial-section li::before {
      content: "→";
      position: absolute;
      left: 0;
      color: #0cf;
    }
    
    /* Разные цвета для разделов */
    .tutorial-intro { 
      background: rgba(25, 130, 196, 0.2); 
      border: 1px solid rgba(0, 200, 255, 0.4);
    }
    .tutorial-intro::before { background: #00aaff; }
    
    .tutorial-main-menu { 
      background: rgba(106, 27, 154, 0.2); 
      border: 1px solid rgba(186, 104, 200, 0.4);
    }
    .tutorial-main-menu::before { background: #ab47bc; }
    
    .tutorial-profile { 
      background: rgba(46, 125, 50, 0.2); 
      border: 1px solid rgba(102, 187, 106, 0.4);
    }
    .tutorial-profile::before { background: #66bb6a; }
    
    .tutorial-notes { 
      background: rgba(183, 28, 28, 0.2); 
      border: 1px solid rgba(239, 83, 80, 0.4);
    }
    .tutorial-notes::before { background: #ef5350; }
    
    .tutorial-photo { 
      background: rgba(245, 124, 0, 0.2); 
      border: 1px solid rgba(255, 167, 38, 0.4);
    }
    .tutorial-photo::before { background: #ffa726; }
    
    .tutorial-game { 
      background: rgba(123, 31, 162, 0.2); 
      border: 1px solid rgba(186, 104, 200, 0.4);
    }
    .tutorial-game::before { background: #ba68c8; }
    
    .tutorial-razdavilka { 
      background: rgba(0, 96, 100, 0.2); 
      border: 1px solid rgba(38, 198, 218, 0.4);
    }
    .tutorial-razdavilka::before { background: #26c6da; }
    
    .tutorial-achievements { 
      background: rgba(255, 160, 0, 0.2); 
      border: 1px solid rgba(255, 213, 79, 0.4);
    }
    .tutorial-achievements::before { background: #ffd54f; }
    
    .tutorial-pin { 
      background: rgba(57, 73, 171, 0.2); 
      border: 1px solid rgba(92, 107, 192, 0.4);
    }
    .tutorial-pin::before { background: #5c6bc0; }
    
    .tutorial-audio { 
      background: rgba(0, 137, 123, 0.2); 
      border: 1px solid rgba(38, 198, 218, 0.4);
    }
    .tutorial-audio::before { background: #26c6da; }
    
    /* Новый раздел для переводчика */
    .tutorial-translator { 
      background: rgba(126, 87, 194, 0.2); 
      border: 1px solid rgba(179, 157, 219, 0.4);
    }
    .tutorial-translator::before { background: #7e57c2; }
    
    .tutorial-completion { 
      background: rgba(27, 94, 32, 0.2); 
      border: 1px solid rgba(56, 142, 60, 0.4);
      text-align: center;
      padding: 30px;
    }
    .tutorial-completion::before { background: #388e3c; }
    
    .tutorial-completion h2 {
      color: #4caf50;
      font-size: 2rem;
      text-shadow: 0 0 15px rgba(76, 175, 80, 0.7);
    }
    
    .banker-badge {
      font-size: 3rem;
      margin: 20px 0;
      animation: pulse 2s infinite;
      text-shadow: 0 0 20px gold;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    /* Стили для переводчика */
    #translatorSection {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    
    #translatorInput {
      font-size: 20px;
      padding: 10px;
      width: 80%;
      max-width: 400px;
      border: none;
      border-radius: 5px;
      background: #222;
      color: white;
      margin-bottom: 20px;
    }
    
    #translatorResult {
      margin-top: 20px;
      font-size: 24px;
      padding: 15px;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      width: 90%;
      max-width: 600px;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .translator-note {
      margin-top: 10px;
      color: #aaa;
      font-size: 14px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Обновленный загрузчик -->
  <div class="loader-container" id="loader">
    <div class="logo-wrapper">
      <div class="loader-text banka">BANKA</div>
      <div class="loader-text os">OS</div>
    </div>
    <div class="dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
    <div class="particles">
      <!-- 20 частиц -->
      <div class='particle'></div><div class='particle'></div><div class='particle'></div>
      <div class='particle'></div><div class='particle'></div><div class='particle'></div>
      <div class='particle'></div><div class='particle'></div><div class='particle'></div>
      <div class='particle'></div><div class='particle'></div><div class='particle'></div>
      <div class='particle'></div><div class='particle'></div><div class='particle'></div>
      <div class='particle'></div><div class='particle'></div><div class='particle'></div>
      <div class='particle'></div><div class='particle'></div>
    </div>
  </div>

  <!-- Компоненты ОС -->
  <div id="pinPromptOverlay">
    <div id="pinPromptBox">
      <div id="pinPromptText" style="font-size:1.2em;color:black;">Введите PIN-код:</div>
      <input type="password" id="pinInput" maxlength="4" />
      <button onclick="submitPin()">OK</button>
      <div id="pinWarning">⚠ Осталось 5 попыток, иначе BANKA.OS будет сброшена</div>
    </div>
  </div>

  <div id="loginScreen" class="screen">
    <img id="avatar" src="https://files.catbox.moe/94rsda.jpg" alt="Avatar" />
    <div style="font-size: 1.5em;" id="userDisplay">Пользователь: BANKA</div>
    
    <div class="unlock-container">
      <div class="unlock-text" id="unlockText">Проведите вверх, чтобы разблокировать</div>
      <div class="unlock-arrow">↑</div>
    </div>
  </div>

  <div id="mainMenu" class="screen">
    <button onclick="playClick(); showSection('tutorial')">📘 Обучение</button>
    <!-- Новая кнопка переводчика -->
    <button onclick="playClick(); showSection('translator')">📖 Переводчик</button>
    <button onclick="playClick(); showSection('announcements')">📢 Объявления</button>
    <button onclick="playClick(); showSection('photo')">📸 Фото одним кликом</button>
    <button onclick="playClick(); showSection('game')">🎮 Поиграть в ParodiaBall</button>
    <button onclick="playClick(); showSection('notes')">📝 Заметки</button>
    <button onclick="playClick(); showSection('razdavilka')">🫨 Раздавилка</button>
    <button onclick="playClick(); showSection('achievements')">🏆 Достижения</button>
    <button onclick="playClick(); showSection('settings')">⚙ Настройки</button>
  </div>
  
  <!-- Новый раздел обучения -->
  <div id="tutorialSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <div class="tutorial-container">
      <div class="tutorial-section tutorial-intro">
        <h2>🌀 запуск системы</h2>
        <p>всё начинается красиво:</p>
        <ul>
          <li>чёрный экран</li>
          <li>синие частицы</li>
          <li>надпись BANKA OS как будто ты загрузил галактическую винду 2099</li>
          <li>→ потом перед тобой стрелка "войти"</li>
        </ul>
        <p>если есть PIN — вводи.<br>10 ошибок? всё, банк обнуляется.</p>
      </div>
      
      <div class="tutorial-section tutorial-main-menu">
        <h2>🏠 главное меню</h2>
        <p>после входа перед тобой несколько кнопок — как несколько ворот в цифровой рай:</p>
        <ul>
          <li><strong>📘 обучение</strong> — всё что ты сейчас читаешь</li>
          <li><strong>📖 переводчик</strong> — магический переводчик слов и фраз</li>
          <li><strong>📢 объявления</strong> — тут Джон вещает. новости, обновы и иногда приколы.</li>
          <li><strong>📸 фото одним кликом</strong> — хочешь фотку? получи. хочешь любимую? в избранное.</li>
          <li><strong>🎮 parodiaball</strong> — игра,где мячик может упасть, но твой дух не упадёт.</li>
          <li><strong>📝 заметки</strong> — записывай свои мысли, чтобы потом перечитать и сказать: "чё я писал?"</li>
          <li><strong>🫨 раздавилка</strong> — вставь фото и сожми его, как будто оно не сдало экзамен.</li>
          <li><strong>🏆 достижения</strong> — твоя цифровая слава. заслужена потом и звёздами.</li>
          <li><strong>⚙ настройки</strong> — всё, что связано с PIN, профилем и кнопкой "удалить всё" (для храбрецов).</li>
        </ul>
      </div>
      
      <div class="tutorial-section tutorial-profile">
        <h2>👤 профиль</h2>
        <p>в настройках ты можешь:</p>
        <ul>
          <li>сменить имя (даже на Банан-1337)</li>
          <li>поставить аватар (лучше, чем у хейтеров с инета)</li>
        </ul>
        <p>и всё это сохраняется в памяти — даже если инет упадёт или сосиска упадёт на экран.</p>
      </div>
      
      <div class="tutorial-section tutorial-notes">
        <h2>📝 заметки</h2>
        <ul>
          <li>нажми + — чтобы создать заметку</li>
          <li>нажми по заметке дважды — чтобы редактировать</li>
          <li>нажми × — чтобы удалить (без сожалений)</li>
        </ul>
        <p>всё сохраняется в памяти устройства. твои гениальные идеи — в безопасности.</p>
      </div>
      
      <div class="tutorial-section tutorial-photo">
        <h2>📸 фото одним кликом</h2>
        <ul>
          <li>нажми кнопку — появится фотка</li>
          <li>нажми ☆ — добавь в избранное</li>
          <li>нажми 🌟 — открой избранное</li>
        </ul>
        <p><strong>📡 нужен интернет.</strong> если вайфая нет — фотка не придёт, потому что она онлайн-зависимая, как игроман без игр.</p>
      </div>
      
      <div class="tutorial-section tutorial-game">
        <h2>🎮 parodiaball</h2>
        <p>играешь за мяч. он прыгает.<br>
        ты ловишь звёзды, платформы, боль, смысл жизни.<br>
        пройдёшь уровень — получишь достижения.<br>
        не пройдёшь — ну... пройдёшь потом 😎</p>
      </div>
      
      <div class="tutorial-section tutorial-razdavilka">
        <h2>🫨 раздавилка</h2>
        <ul>
          <li>загрузи фото</li>
          <li>выбери формат (1:1, 9:16, 16:9)</li>
          <li>нажми «раздавить»</li>
          <li>получи результат с фирменной меткой:<br>
          <em>"подвержено давлению от BANKA.OS"</em></li>
        </ul>
        <p><strong>📌 если вдруг не работает</strong> — вставь фото снова. иногда раздавилка замирает от шока.</p>
      </div>
      
      <div class="tutorial-section tutorial-achievements">
        <h2>🏆 достижения</h2>
        <p>получаешь за игру:</p>
        <ul>
          <li>5, 10, 25, 50, 100 уровней — и ты почти бог parodiaball</li>
        </ul>
        <p>достижения отображаются в отдельной вкладке, и они никогда не забудут твои подвиги.</p>
      </div>
      
      <div class="tutorial-section tutorial-pin">
        <h2>🗝 PIN-код</h2>
        <ul>
          <li>ставишь PIN в настройках</li>
          <li>при входе система просит его</li>
          <li>10 неправильных попыток — и банк сжигает все данные 🔥</li>
        </ul>
        <p>для защиты от брата, сестры и соседей-шпионов.</p>
      </div>
      
      <div class="tutorial-section tutorial-audio">
        <h2>🔊 музыка и звуки</h2>
        <ul>
          <li>в нижнем правом углу — кнопка 🔊 / 🔇</li>
          <li>нажал — играет внутренняя музыка</li>
          <li>нажал снова — тишина, как в пустом банке</li>
          <li>клики и победы звучат сами по себе</li>
        </ul>
        <p><strong>⚠️ браузеры не дают включать звук без нажатия</strong>, так что тапни сначала — потом наслаждайся.</p>
        <p>🎧 в будущем возможна озвучка джона, но он сейчас в отпуске.</p>
      </div>
      
      <!-- Новый раздел для переводчика -->
      <div class="tutorial-section tutorial-translator">
        <h2>📖 Переводчик</h2>
        <p>введи слово сверху — магия снизу</p>
        <p>работает с русским и английским (без драки)</p>
        <ul>
          <li>напишешь "кошка" — получишь cat</li>
          <li>напишешь "cat" — получишь кошка</li>
          <li>напишешь "кошкотанк" — получишь "перевод не найден, но идея годная"</li>
        </ul>
        <p>можно фразы!<br>я люблю суп → i love soup</p>
        <p>но "я член комитета" — осторожно, переведёт как военный отчёт 😬</p>
        <p>ничего не надо сохранять, всё в голове у БанкаОС<br>не пиши в нижнее поле — оно святое.</p>
      </div>
      
      <div class="tutorial-section tutorial-completion">
        <div class="banker-badge">🏆</div>
        <h2>✅ теперь ты банкер</h2>
        <p>обучение пройдено.<br>
        ты теперь не просто пользователь, а банкер 1 уровня с уважением.<br>
        если что-то непонятно — нажимай всё подряд.</p>
      </div>
    </div>
  </div>

  <!-- Новый раздел переводчика -->
  <div id="translatorSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <h2>Переводчик</h2>
    <input id="translatorInput" placeholder="Введите слова" />
    <div id="translatorResult">...</div>
    <div class="translator-note">Нижнее поле святое - не пиши сюда!</div>
  </div>

  <!-- Раздел Раздавилки -->
  <div id="razdavilkaSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <div class="razdavilka-container">
      <div class="preview-wrapper">
        <label class="preview-container">
          <canvas class="preview-canvas"></canvas>
          <div class="placeholder-text">Нажмите, чтобы вставить фото</div>
          <input type="file" class="hidden-input" accept="image/*">
        </label>
      </div>
      <div class="buttons-row">
        <button class="razdavilka-btn active-btn" data-ratio="1:1">1:1</button>
        <button class="razdavilka-btn" data-ratio="9:16">9:16</button>
        <button class="razdavilka-btn" data-ratio="16:9">16:9</button>
      </div>
      <div class="note-insert">С первого раза фото не вставляется, просим 2 раза вставить фото</div>
      <button class="download-btn">СКАЧАТЬ</button>
    </div>
  </div>

  <!-- Остальные разделы ОС -->
  <div id="photoSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <button id="favoriteBtn" onclick="showSection('favorites')">🌟</button>
    <button id="starBtn" onclick="toggleFavorite()">☆</button>
    <div id="photoSquare"></div>
    <button onclick="playClick(); showPhoto()">Показать фото</button>
  </div>

  <div id="favoritesSection" class="screen">
    <button class="backBtn" onclick="showSection('photo')">◀</button>
    <div id="favoritesGallery"></div>
  </div>
  
  <div id="notesSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <div id="notesList"></div>
    <button id="addNoteBtn" onclick="createNewNote()">+</button>
  </div>

  <div id="announcementsSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <div id="announcementsList" style="padding:10px; overflow-y:auto; width:90%; max-height:80%;"></div>
  </div>

  <div id="achievementsSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <div id="achievementList"></div>
  </div>

  <div id="settingsSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <button onclick="showSection('profile')">Профиль</button>
    <button onclick="showSection('pinSettings')">Пароль</button>
  </div>

  <div id="profileSection" class="screen">
    <button class="backBtn" onclick="showSection('settings')">◀</button>
    <img id="avatarProfile" src="https://files.catbox.moe/94rsda.jpg" alt="Avatar" />
    <div style="font-size:1.2em;" id="userDisplayProfile">Пользователь: BANKA</div>
    <button onclick="changeNameProfile()">Сменить имя</button>
    <button onclick="changeAvatarProfile()">Сменить фото</button>
    <button onclick="resetProfile()">Сбросить профиль</button>
  </div>

  <div id="pinSettingsSection" class="screen">
    <button class="backBtn" onclick="showSection('settings')">◀</button>
    <button onclick="setPin()">Установить PIN-код</button>
    <button onclick="removePin()">Удалить PIN-код</button>
  </div>
  
  <div id="gameSection" class="screen">
    <button class="backBtn" onclick="showSection('main')">◀</button>
    <div id="gameNotice">Мобильная версия ParodiaBall сломанная, просим перейти на ПК версию сайта!</div>
    <canvas id="gameCanvas"></canvas>
    <div id="win">
      <div>Вы выиграли!</div>
      <button onclick="nextLevel()">Новый уровень</button>
    </div>
  </div>

  <div id="achievementBanner" class="achievement"></div>
  <div id="noteEditor">
    <textarea id="noteEditorText" placeholder="Введите текст заметки..."></textarea>
    <button onclick="saveNote()">Сохранить</button>
    <button onclick="cancelEdit()">Отмена</button>
  </div>

  <input type="file" id="avatarInput" accept="image/*" style="display:none;" />
  <button id="audioBtn" onclick="toggleAudio()">🔇</button>

  <!-- Аудио ресурсы -->
  <audio id="clickSound"><source src="https://files.catbox.moe/xp0o5c.mp3" /></audio>
  <audio id="winSound"><source src="https://files.catbox.moe/1f2se4.mp3" /></audio>
  <audio id="startupSound"><source src="https://files.catbox.moe/otlana.mp3" /></audio>
  <audio id="bgMusic" loop><source src="https://files.catbox.moe/w7d9lj.mp3" /></audio>

  <script>
    // Инициализация частиц
    document.addEventListener('DOMContentLoaded', function() {
      const particles = document.querySelectorAll('.particle');
      particles.forEach(particle => {
        const angle = Math.random() * Math.PI * 2;
        const distance = 50 + Math.random() * 150;
        const dx = Math.cos(angle) * distance;
        const dy = Math.sin(angle) * distance;
        particle.style.setProperty('--dx', dx + 'px');
        particle.style.setProperty('--dy', dy + 'px');
        particle.style.animationDelay = (Math.random() * 0.5) + 's';
      });
    });

    // Основные компоненты ОС
    const pinOverlay = document.getElementById("pinPromptOverlay");
    const pinInput = document.getElementById("pinInput");
    const pinWarning = document.getElementById("pinWarning");
    const loginScreen = document.getElementById("loginScreen");
    const mainMenu = document.getElementById("mainMenu");
    const photoSection = document.getElementById("photoSection");
    const favoritesSection = document.getElementById("favoritesSection");
    const notesSection = document.getElementById("notesSection");
    const notesList = document.getElementById("notesList");
    const addNoteBtn = document.getElementById("addNoteBtn");
    const noteEditor = document.getElementById("noteEditor");
    const noteEditorText = document.getElementById("noteEditorText");
    const achievementsSection = document.getElementById("achievementsSection");
    const settingsSection = document.getElementById("settingsSection");
    const profileSection = document.getElementById("profileSection");
    const pinSettingsSection = document.getElementById("pinSettingsSection");
    const gameSection = document.getElementById("gameSection");
    const avatar = document.getElementById("avatar");
    const avatarProfile = document.getElementById("avatarProfile");
    const userDisplay = document.getElementById("userDisplay");
    const userDisplayProfile = document.getElementById("userDisplayProfile");
    const avatarInput = document.getElementById("avatarInput");
    const clickSound = document.getElementById("clickSound");
    const winSound = document.getElementById("winSound");
    const startupSound = document.getElementById("startupSound");
    const bgMusic = document.getElementById("bgMusic");
    const audioBtn = document.getElementById("audioBtn");
    const gameNotice = document.getElementById("gameNotice");
    const achievementBanner = document.getElementById("achievementBanner");
    const achievementList = document.getElementById("achievementList");
    const starBtn = document.getElementById("starBtn");
    const favoritesGallery = document.getElementById("favoritesGallery");
    const unlockText = document.getElementById("unlockText");
    const unlockArrow = document.querySelector(".unlock-arrow");
    const translatorInput = document.getElementById("translatorInput");
    const translatorResult = document.getElementById("translatorResult");

    let musicIsPlaying = false;
    let level = 1;
    let pinTries = 0;
    let achievements = JSON.parse(localStorage.getItem("achievements")) || [];
    let currentPhotoUrl = '';
    let favoritePhotos = JSON.parse(localStorage.getItem("favoritePhotos")) || [];
    let notes = JSON.parse(localStorage.getItem("notes")) || [];
    let startY = 0;
    let currentY = 0;
    let unlockDeltaY = 0;
    let swipeThreshold = window.innerHeight * 0.2; // 20% высоты экрана
    
    // Словарь для переводчика
    const dict = {
      // Русский -> Английский
      "привет": "hello", "мама": "mom", "папа": "dad", "кошка": "cat", "собака": "dog",
      "да": "yes", "нет": "no", "спасибо": "thank you", "пожалуйста": "please",
      "яблоко": "apple", "банан": "banana", "арбуз": "watermelon", "груша": "pear",
      "апельсин": "orange", "машина": "car", "автобус": "bus", "поезд": "train",
      "самолёт": "plane", "дом": "house", "дверь": "door", "окно": "window",
      "стол": "table", "стул": "chair", "кровать": "bed", "шкаф": "closet",
      "вода": "water", "чай": "tea", "кофе": "coffee", "молоко": "milk",
      "еда": "food", "мясо": "meat", "рыба": "fish", "суп": "soup", "сахар": "sugar",
      "соль": "salt", "ложка": "spoon", "вилка": "fork", "нож": "knife",
      "голова": "head", "рука": "hand", "нога": "leg", "глаз": "eye",
      "ухо": "ear", "нос": "nose", "рот": "mouth", "волосы": "hair", "лицо": "face",
      "врач": "doctor", "учитель": "teacher", "школа": "school", "ученик": "student",
      "брат": "brother", "сестра": "sister", "друг": "friend", "враг": "enemy",
      "жена": "wife", "муж": "husband", "дедушка": "grandfather", "бабушка": "grandmother",
      "внук": "grandson", "внучка": "granddaughter", "песня": "song", "музыка": "music",
      "фильм": "movie", "игра": "game", "интернет": "internet", "погода": "weather",
      "дождь": "rain", "снег": "snow", "ветер": "wind", "жарко": "hot", "холодно": "cold",
      "солнечно": "sunny", "пасмурно": "cloudy", "тихо": "quiet", "громко": "loud",
      "красный": "red", "зелёный": "green", "синий": "blue", "жёлтый": "yellow",
      "белый": "white", "чёрный": "black", "большой": "big", "маленький": "small",
      "быстро": "fast", "медленно": "slow", "утро": "morning", "день": "day",
      "вечер": "evening", "ночь": "night", "вчера": "yesterday", "сегодня": "today",
      "завтра": "tomorrow", "работа": "work", "работать": "to work", "читать": "to read",
      "писать": "to write", "говорить": "to speak", "сказать": "to say",
      "смотреть": "to watch", "слушать": "to listen", "бежать": "to run",
      "идти": "to go", "сидеть": "to sit", "стоять": "to stand", "любить": "to love",

      // Английский -> Русский
      "hello": "привет", "mom": "мама", "dad": "папа", "cat": "кошка", "dog": "собака",
      "yes": "да", "no": "нет", "thank you": "спасибо", "please": "пожалуйста",
      "apple": "яблоко", "banana": "банан", "watermelon": "арбуз", "pear": "груша",
      "orange": "апельсин", "car": "машина", "bus": "автобус", "train": "поезд",
      "plane": "самолёт", "house": "дом", "door": "дверь", "window": "окно",
      "table": "стол", "chair": "стул", "bed": "кровать", "closet": "шкаф",
      "water": "вода", "tea": "чай", "coffee": "кофе", "milk": "молоко",
      "food": "еда", "meat": "мясо", "fish": "рыба", "soup": "суп", "sugar": "сахар",
      "salt": "соль", "spoon": " ложка", "fork": "вилка", "knife": "нож",
      "head": "голова", "hand": "рука", "leg": "нога", "eye": "глаз",
      "ear": "ухо", "nose": "нос", "mouth": "рот", "hair": "волосы", "face": "лицо",
      "doctor": "врач", "teacher": "учитель", "school": "школа", "student": "ученик",
      "brother": "брат", "sister": "сестра", "friend": "друг", "enemy": "враг",
      "wife": "жена", "husband": "муж", "grandfather": "дедушка", "grandmother": "бабушка",
      "grandson": "внук", "granddaughter": "внучка", "song": "песня", "music": "музыка",
      "movie": "фильм", "game": "игра", "internet": "интернет", "weather": "погода",
      "rain": "дождь", "snow": "снег", "wind": "ветер", "hot": "жарко", "cold": "холодно",
      "sunny": "солнечно", "cloudy": "пасмурно", "quiet": "тихо", "loud": "громко",
      "red": "красный", "green": "зелёный", "blue": "синий", "yellow": "жёлтый",
      "white": "белый", "black": "чёрный", "big": "большой", "small": "маленький",
      "fast": "быстро", "slow": "медленно", "morning": "утро", "day": "день",
      "evening": "вечер", "night": "ночь", "yesterday": "вчера", "today": "сегодня",
      "tomorrow": "завтра", "work": "работа", "to work": "работать", "to read": "читать",
      "to write": "писать", "to speak": "говорить", "to say": "сказать",
      "to watch": "смотреть", "to listen": "слушать", "to run": "бежать",
      "to go": "идти", "to sit": "сидеть", "to stand": "стоять", "to love": "любить"
    };

    function showAchievement(msg) {
      achievementBanner.textContent = msg;
      achievementBanner.style.display = 'block';
      setTimeout(() => { achievementBanner.style.display = 'none'; }, 3000);
      achievements.push(msg);
      localStorage.setItem('achievements', JSON.stringify(achievements));
      updateAchievements();
    }

    function updateAchievements() {
      achievementList.innerHTML = '';
      achievements.forEach(msg => {
        const div = document.createElement('div');
        div.textContent = msg;
        div.style.background = 'gold';
        div.style.color = 'black';
        div.style.padding = '10px';
        div.style.margin = '5px';
        div.style.borderRadius = '5px';
        achievementList.appendChild(div);
      });
    }

    let currentNoteIndex = -1;
    let lastClickTime = 0;

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const winScreen = document.getElementById("win");

    const GRAVITY = 0.5;
    const JUMP_VY = -12;
    const MOVE_SPEED = 3;
    const PLATFORM_WIDTH = 120;
    const PLATFORM_HEIGHT = 12;
    const STAR_RADIUS = 10;
    const TOTAL_PLATFORMS = 20;
    const STAR_PLATFORMS = [10, 15, 20];

    let platforms = [], stars = [], starsCollected = 0;
    let ball = { x: 0, y: 0, radius: 15, vx: 0, vy: 0 };
    let moving = { left: false, right: false };
    let animFrameId = null;

    function hideAll() {
      [loginScreen, mainMenu, photoSection, favoritesSection, notesSection, 
       achievementsSection, settingsSection, profileSection, 
       pinSettingsSection, gameSection, razdavilkaSection, 
       announcementsSection, tutorialSection, translatorSection].forEach(s => s.style.display = 'none');
    }

    function showScreen(screenEl) {
      hideAll();
      screenEl.style.display = 'flex';
      if (screenEl === notesSection) {
        updateNotesList();
      }
    }

    function initSettings() {
      const name = localStorage.getItem("banka_name");
      const ava = localStorage.getItem("banka_avatar");
      if (name) {
        userDisplay.textContent = "Пользователь: " + name;
        userDisplayProfile.textContent = "Пользователь: " + name;
      }
      if (ava) {
        avatar.src = ava;
        avatarProfile.src = ava;
      }
      updateAchievements();
    }

    function attemptLogin() {
      const pin = localStorage.getItem("banka_pin");
      if (pin) {
        pinOverlay.style.display = 'flex';
        pinInput.value = '';
        pinWarning.style.display = 'none';
        pinTries = 0;
      } else {
        startOS();
      }
    }

    function submitPin() {
      const saved = localStorage.getItem("banka_pin");
      if (pinInput.value === saved) {
        pinOverlay.style.display = 'none';
        pinTries = 0;
        startOS();
      } else {
        pinTries++;
        if (pinTries >= 5 && pinTries < 10) {
          pinWarning.style.display = 'block';
        }
        if (pinTries >= 10) {
          resetProfile();
          localStorage.removeItem("banka_pin");
          pinTries = 0;
          pinOverlay.style.display = 'none';
          alert("Все данные сброшены. Запуск заново.");
          showScreen(loginScreen);
        } else {
          alert("Неверный PIN. Попыток: " + pinTries + "/10");
        }
      }
    }

    function startOS() {
      // Анимация перехода к главному экрану
      loginScreen.style.transform = 'translateY(-100%)';
      mainMenu.style.transform = 'translateY(0)';
      mainMenu.style.display = 'flex';
      
      setTimeout(() => {
        loginScreen.style.display = 'none';
        loginScreen.style.transform = '';
        mainMenu.style.transform = '';
      }, 500);
      
      audioBtn.style.display = 'flex';
      startupSound.play().catch(() => {});
    }

    function playClick() {
      if (!musicIsPlaying) { clickSound.currentTime = 0; clickSound.play(); }
    }

    function playWinSound() {
      if (!musicIsPlaying) { winSound.currentTime = 0; winSound.play(); }
    }

    function toggleAudio() {
      if (bgMusic.paused) {
        bgMusic.play().catch(() => {});
        audioBtn.textContent = "🔊";
        musicIsPlaying = true;
      } else {
        bgMusic.pause();
        audioBtn.textContent = "🔇";
        musicIsPlaying = false;
      }
    }

    function showSection(name) {
      switch(name) {
        case 'main': showScreen(mainMenu); break;
        case 'tutorial': showScreen(document.getElementById('tutorialSection')); break;
        case 'photo': showScreen(photoSection); showPhoto(); break;
        case 'favorites': showScreen(favoritesSection); showFavorites(); break;
        case 'notes': showScreen(notesSection); break;
        case 'razdavilka': showScreen(razdavilkaSection); initRazdavilka(); break;
        case 'announcements': showScreen(announcementsSection); loadAnnouncements(); break;
        case 'achievements': showScreen(achievementsSection); updateAchievements(); break;
        case 'settings': showScreen(settingsSection); break;
        case 'profile': showScreen(profileSection); break;
        case 'pinSettings': showScreen(pinSettingsSection); break;
        case 'game':
          showScreen(gameSection);
          gameNotice.style.display = 'block';
          setTimeout(() => gameNotice.style.display = 'none', 5000);
          initGame();
          break;
        case 'translator': 
          showScreen(document.getElementById('translatorSection')); 
          translatorInput.value = '';
          translatorResult.textContent = '...';
          break;
      }
    }
    
  function showPhoto() {
      const photoSquare = document.getElementById("photoSquare");
      const randomUrl = `https://picsum.photos/800?random=${Math.floor(Math.random() * 10000)}`;
      currentPhotoUrl = randomUrl;
      photoSquare.innerHTML = `<img src="${randomUrl}" alt="Random">`;
      starBtn.textContent = favoritePhotos.includes(randomUrl) ? "★" : "☆";
    }

    function toggleFavorite() {
      if (favoritePhotos.includes(currentPhotoUrl)) {
        favoritePhotos = favoritePhotos.filter(url => url !== currentPhotoUrl);
        starBtn.textContent = "☆";
      } else {
        favoritePhotos.push(currentPhotoUrl);
        starBtn.textContent = "★";
      }
      localStorage.setItem("favoritePhotos", JSON.stringify(favoritePhotos));
    }

    function showFavorites() {
      favoritesGallery.innerHTML = '';
      if (favoritePhotos.length === 0) {
        favoritesGallery.innerHTML = '<div style="color:white;text-align:center;">Нет избранных фото</div>';
        return;
      }
      
      favoritePhotos.forEach(url => {
        const img = document.createElement('img');
        img.src = url;
        img.className = 'favorite-item';
        img.onclick = () => {
          currentPhotoUrl = url;
          showSection('photo');
        };
        favoritesGallery.appendChild(img);
      });
    }

    function initGame() {
      if (animFrameId) cancelAnimationFrame(animFrameId);
      
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      platforms = [];
      stars = [];
      starsCollected = 0;
      winScreen.style.display = 'none';
      
      const vSpacing = canvas.height / (TOTAL_PLATFORMS + 1);
      let prevX = canvas.width / 2 - PLATFORM_WIDTH / 2;
      
      for (let i = 1; i <= TOTAL_PLATFORMS; i++) {
        const y = canvas.height - vSpacing * i;
        const step = (Math.random() * 2 - 1) * 80;
        let x = prevX + step;
        x = Math.max(10, Math.min(x, canvas.width - PLATFORM_WIDTH - 10));
        platforms.push({ x, y, w: PLATFORM_WIDTH, h: PLATFORM_HEIGHT });
        if (STAR_PLATFORMS.includes(i)) {
          stars.push({ x: x + PLATFORM_WIDTH/2, y: y - STAR_RADIUS - 5, r: STAR_RADIUS, collected: false });
        }
        prevX = x;
      }
      
      resetBall();
      animFrameId = requestAnimationFrame(gameLoop);
    }

    function resetBall() {
      const p = platforms[0];
      ball.x = p.x + p.w / 2;
      ball.y = p.y - ball.radius;
      ball.vx = 0;
      ball.vy = 0;
    }

    function gameLoop() {
      updateGame();
      drawGame();
      animFrameId = requestAnimationFrame(gameLoop);
    }

    function updateGame() {
      ball.vy += GRAVITY;
      if (moving.left) ball.vx = -MOVE_SPEED;
      else if (moving.right) ball.vx = MOVE_SPEED;
      else ball.vx *= 0.8;
      
      ball.x += ball.vx;
      ball.y += ball.vy;
      
      platforms.forEach(p => {
        if (ball.vy > 0 && ball.y + ball.radius >= p.y && ball.y + ball.radius <= p.y + p.h && 
            ball.x + ball.radius > p.x && ball.x - ball.radius < p.x + p.w) {
          ball.y = p.y - ball.radius;
          ball.vy = JUMP_VY;
        }
      });
      
      stars.forEach(s => {
        if (!s.collected) {
          const dx = ball.x - s.x;
          const dy = ball.y - s.y;
          if (Math.hypot(dx,dy) < ball.radius + s.r/2) {
            s.collected = true;
            starsCollected++;
            if (starsCollected === stars.length) {
              winScreen.style.display = 'block';
              playWinSound();
            }
          }
        }
      });
      
      if (ball.y - ball.radius > canvas.height) resetBall();
      if (ball.x < ball.radius) ball.x = ball.radius;
      if (ball.x > canvas.width - ball.radius) ball.x = canvas.width - ball.radius;
    }

    function drawGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'skyblue';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      ctx.fillStyle = 'white';
      platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));
      
      stars.forEach(s => {
        if (!s.collected) {
          ctx.beginPath();
          for (let i = 0; i < 5; i++) {
            const ang = i * 2 * Math.PI / 5 - Math.PI/2;
            const rad = i % 2 === 0 ? s.r : s.r/2;
            ctx.lineTo(s.x + Math.cos(ang)*rad, s.y + Math.sin(ang)*rad);
          }
          ctx.closePath();
          ctx.fillStyle = 'gold'; 
          ctx.fill();
        }
      });
      
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
      ctx.fillStyle = 'yellow';
      ctx.fill();
      
      ctx.fillStyle = '#000';
      ctx.font = '20px sans-serif';
      ctx.fillText('Уровень: '+level, 10, 30);
    }

    function nextLevel() {
      level++;
      const milestones = [5,10,15,20,25,30,35,40,45,50,75,100];
      if (milestones.includes(level)) {
        const msg = `Вы прошли ${level} уровней`;
        if (!achievements.includes(msg)) showAchievement(msg);
      }
      winScreen.style.display = 'none';
      initGame();
    }

    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') moving.left = true;
      if (e.key === 'ArrowRight') moving.right = true;
    });

    window.addEventListener('keyup', e => {
      if (e.key === 'ArrowLeft') moving.left = false;
      if (e.key === 'ArrowRight') moving.right = false;
    });

    window.addEventListener('mousedown', e => {
      moving.left = e.clientX < canvas.width/2;
      moving.right = !moving.left;
    });

    window.addEventListener('mouseup', () => { 
      moving.left = moving.right = false; 
    });

    window.addEventListener('touchstart', e => {
      const x = e.touches[0].clientX;
      moving.left = x < canvas.width/2;
      moving.right = !moving.left;
    });

    window.addEventListener('touchend', () => { 
      moving.left = moving.right = false; 
    });

    function updateNotesList() {
      notesList.innerHTML = '';
      if (notes.length === 0) {
        notesList.innerHTML = '<div style="color:#aaa;text-align:center;">Нет заметок</div>';
        return;
      }
      
      notes.forEach((note, index) => {
        const noteEl = document.createElement('div');
        noteEl.className = 'note';
        
        const preview = note.length > 20 ? note.substring(0, 20) + '...' : note;
        const fullContent = note;
        
        noteEl.innerHTML = `
          <div class="note-preview">${preview}</div>
          <div class="note-content" style="display:none;">${fullContent}</div>
          <button class="note-delete" onclick="deleteNote(${index},event)">×</button>
        `;
        
        noteEl.onclick = (e) => {
          if (e.target.classList.contains('note-delete')) return;
          
          const now = new Date().getTime();
          if (now - lastClickTime < 300) {
            editNote(index);
          } else {
            const preview = noteEl.querySelector('.note-preview');
            const content = noteEl.querySelector('.note-content');
            
            if (preview.style.display === 'none') {
              preview.style.display = 'block';
              content.style.display = 'none';
            } else {
              preview.style.display = 'none';
              content.style.display = 'block';
            }
          }
          lastClickTime = now;
        };
        
        notesList.appendChild(noteEl);
      });
    }

    function createNewNote() {
      currentNoteIndex = -1;
      noteEditorText.value = '';
      noteEditor.style.display = 'flex';
      noteEditorText.focus();
    }

    function editNote(index) {
      currentNoteIndex = index;
      noteEditorText.value = notes[index];
      noteEditor.style.display = 'flex';
      noteEditorText.focus();
    }

    function saveNote() {
      const text = noteEditorText.value.trim();
      if (text) {
        if (currentNoteIndex === -1) {
          notes.push(text);
        } else {
          notes[currentNoteIndex] = text;
        }
        localStorage.setItem("notes", JSON.stringify(notes));
        updateNotesList();
      }
      noteEditor.style.display = 'none';
    }

    function cancelEdit() {
      noteEditor.style.display = 'none';
    }

    function deleteNote(index, event) {
      event.stopPropagation();
      if (confirm('Удалить эту заметку?')) {
        notes.splice(index, 1);
        localStorage.setItem("notes", JSON.stringify(notes));
        updateNotesList();
      }
    }

    function setPin() {
      const pin = prompt("Установите 4-значный PIN:");
      if (pin === null) return;
      if (/^[0-9]{4}$/.test(pin)) {
        localStorage.setItem("banka_pin", pin);
        alert("PIN установлен");
      } else {
        alert("Нужно вводить ровно 4 цифры!");
      }
    }
    
    function removePin() {
      const currentPin = localStorage.getItem("banka_pin");
      if (!currentPin) {
        alert("PIN не установлен");
        return;
      }
      const entered = prompt("Введите текущий PIN для удаления:");
      if (entered === null) return;
      if (entered === currentPin) {
        localStorage.removeItem("banka_pin");
        alert("PIN удалён");
      } else {
        alert("Неверный PIN. Удаление отменено.");
      }
    }

    function changeNameProfile() {
      const name = prompt("Введите новое имя:");
      if (name) {
        localStorage.setItem("banka_name", name);
        const userDisplay = document.getElementById("userDisplay");
        const userDisplayProfile = document.getElementById("userDisplayProfile");
        userDisplay.textContent = "Пользователь: " + name;
        userDisplayProfile.textContent = "Пользователь: " + name;
      }
    }
    
    function changeAvatarProfile() {
      document.getElementById("avatarInput").click();
    }
    
    function resetProfile() {
      if (confirm("Сбросить профиль? Все данные будут удалены.")) {
        localStorage.removeItem("banka_name");
        localStorage.removeItem("banka_avatar");
        localStorage.removeItem("banka_pin");
        const userDisplay = document.getElementById("userDisplay");
        const userDisplayProfile = document.getElementById("userDisplayProfile");
        userDisplay.textContent = "Пользователь: BANKA";
        userDisplayProfile.textContent = "Пользователь: BANKA";
        const avatar = document.getElementById("avatar");
        const avatarProfile = document.getElementById("avatarProfile");
        avatar.src = "https://files.catbox.moe/94rsda.jpg";
        avatarProfile.src = "https://files.catbox.moe/94rsda.jpg";
      }
    }

function loadAnnouncements() {
  const container = document.getElementById('announcementsList');
  container.innerHTML = '<div style="color:#aaa;text-align:center;">Загрузка...</div>';

  fetch('news.json')
    .then(response => {
      if (!response.ok) throw new Error('Ошибка загрузки');
      return response.json();
    })
    .then(data => {
      container.innerHTML = '';

      const allNews = [
        ...(data.newsFromJohn || []),
        ...(data.news || []),
        ...(data.importantNews || []),
        ...(data.futurePlans || [])
      ];

      if (allNews.length === 0) {
        container.innerHTML = '<div style="color:#aaa;text-align:center;">Нет объявлений</div>';
        return;
      }

      allNews.forEach(item => {
        const el = document.createElement('div');
        el.style.background = '#222';
        el.style.color = 'white';
        el.style.padding = '10px';
        el.style.margin = '10px 0';
        el.style.borderRadius = '8px';
        let title = item.title || '';
        let date = item.date ? ('<div style="font-size:0.9em;color:#888;">' + item.date + '</div>') : '';
        let contentText = item.content || '';
        el.innerHTML = '<div style="font-weight:bold;font-size:1.1em;">' + title + '</div>' + date + '<div style="margin-top:5px;white-space:pre-wrap;">' + contentText + '</div>';
        container.appendChild(el);
      });
    })
    .catch(err => {
      container.innerHTML = '<div style="color:red;text-align:center;">Ошибка загрузки объявлений</div>';
      console.error(err);
    });
}
    // Функции для Раздавилки
    function initRazdavilka() {
      const previewContainer = document.querySelector('#razdavilkaSection .preview-container');
      const placeholderText = document.querySelector('#razdavilkaSection .placeholder-text');
      const canvas = document.querySelector('#razdavilkaSection .preview-canvas');
      const ctx = canvas.getContext('2d');
      const fileInput = document.querySelector('#razdavilkaSection .hidden-input');
      const ratioButtons = document.querySelectorAll('#razdavilkaSection .razdavilka-btn');
      const downloadBtn = document.querySelector('#razdavilkaSection .download-btn');
      
      let img = null;
      let currentRatio = '1:1';

      ratioButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          ratioButtons.forEach(b => b.classList.remove('active-btn'));
          btn.classList.add('active-btn');
          currentRatio = btn.dataset.ratio;
          updatePreviewContainerSize();
          if (img) drawPreview();
        });
      });

      previewContainer.addEventListener('click', () => {
        fileInput.value = '';
        fileInput.click();
      });

      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          const image = new Image();
          image.onload = () => {
            img = image;
            placeholderText.style.display = 'none';
            drawPreview();
          };
          image.src = reader.result;
        };
        reader.readAsDataURL(file);
      });

      downloadBtn.addEventListener('click', () => {
        if (!img) {
          alert('Сначала вставьте фото');
          return;
        }
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
        tempCtx.drawImage(img, 0, 0, tempCanvas.width, tempCanvas.height);
        const text = "Подвержено давлению от BANKA.OS";
        const fontSize = Math.max(10, Math.round(tempCanvas.width / 30));
        tempCtx.fillStyle = "rgba(0, 0, 0, 0.5)";
        tempCtx.font = fontSize + "px sans-serif";
        const padding = 4;
        const rectHeight = fontSize + padding * 2;
        tempCtx.fillRect(0, tempCanvas.height - rectHeight, tempCanvas.width, rectHeight);
        tempCtx.fillStyle = "#fff";
        tempCtx.textBaseline = "middle";
        tempCtx.textAlign = "center";
        tempCtx.fillText(text, tempCanvas.width / 2, tempCanvas.height - rectHeight / 2);

        const link = document.createElement('a');
        link.download = 'razdavilka.jpg';
        link.href = tempCanvas.toDataURL('image/jpeg');
        link.click();
      });

      function updatePreviewContainerSize() {
        const container = document.querySelector('#razdavilkaSection .preview-wrapper');
        const containerWidth = Math.min(container.clientWidth, 300);
        let width = containerWidth;
        let height;
        if (currentRatio === '1:1') {
          height = width;
        } else if (currentRatio === '9:16') {
          height = width * 16 / 9;
        } else if (currentRatio === '16:9') {
          height = width * 9 / 16;
        }
        previewContainer.style.width = width + 'px';
        previewContainer.style.height = height + 'px';
        canvas.width = width;
        canvas.height = height;
        canvas.style.display = img ? 'block' : 'none';
      }

      function drawPreview() {
        updatePreviewContainerSize();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        const text = "Подвержено давлению от BANKA.OS";
        const fontSize = Math.max(10, Math.round(canvas.width / 30));
        ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
        ctx.font = fontSize + "px sans-serif";
        const padding = 4;
        const rectHeight = fontSize + padding * 2;
        ctx.fillRect(0, canvas.height - rectHeight, canvas.width, rectHeight);
        ctx.fillStyle = "#fff";
        ctx.textBaseline = "middle";
        ctx.textAlign = "center";
        ctx.fillText(text, canvas.width / 2, canvas.height - rectHeight / 2);
      }

      window.addEventListener('resize', () => {
        if (img) drawPreview();
        else updatePreviewContainerSize();
      });
      
      updatePreviewContainerSize();
    }
    
    // Инициализация переводчика
    translatorInput.addEventListener("input", function() {
      const text = this.value.trim().toLowerCase();
      if (!text) {
        translatorResult.textContent = "...";
        return;
      }
      
      // Специальные случаи
      if (text === "я член комитета") {
        translatorResult.textContent = "I am a member of the military committee";
        return;
      }
      
      if (text === "кошкотанк") {
        translatorResult.textContent = "перевод не найден, но идея годная";
        return;
      }
      
      // Попробуем перевести всю фразу
      if (dict[text]) {
        translatorResult.textContent = dict[text];
        return;
      }
      
      // Разбиваем на слова и переводим по частям
      const words = text.split(/\s+/);
      const translatedWords = words.map(word => dict[word] || word);
      
      translatorResult.textContent = translatedWords.join(" ");
    });

    // Инициализация при загрузке
    setTimeout(() => {
      document.getElementById('loader').style.display = 'none';
      showScreen(loginScreen);
      initSettings();
    }, 7000);
    
    // Обработчики свайпа для разблокировки
    loginScreen.addEventListener('touchstart', function(e) {
      startY = e.touches[0].clientY;
      unlockDeltaY = 0;
    });

    loginScreen.addEventListener('touchmove', function(e) {
      currentY = e.touches[0].clientY;
      unlockDeltaY = startY - currentY;
      
      if (unlockDeltaY > 0) {
        loginScreen.style.transform = `translateY(${-unlockDeltaY}px)`;
        unlockText.style.opacity = 1 - (unlockDeltaY / 100);
        unlockArrow.style.opacity = 1 - (unlockDeltaY / 100);
      }
    });

    loginScreen.addEventListener('touchend', function() {
      if (unlockDeltaY > swipeThreshold) {
        // Свайп успешен
        loginScreen.style.transition = 'transform 0.5s ease';
        loginScreen.style.transform = 'translateY(-100vh)';
        
        setTimeout(() => {
          loginScreen.style.transition = '';
          loginScreen.style.transform = '';
          unlockText.style.opacity = '';
          unlockArrow.style.opacity = '';
          
          const pin = localStorage.getItem("banka_pin");
          if (pin) {
            pinOverlay.style.display = 'flex';
            pinInput.value = '';
            pinWarning.style.display = 'none';
            pinTries = 0;
          } else {
            startOS();
          }
        }, 500);
      } else {
        // Возвращаем на место
        loginScreen.style.transition = 'transform 0.3s ease';
        loginScreen.style.transform = 'translateY(0)';
        
        setTimeout(() => {
          loginScreen.style.transition = '';
          unlockText.style.opacity = '';
          unlockArrow.style.opacity = '';
        }, 300);
      }
    });
  </script>
</body>
</html>
